exports.id=861,exports.ids=[861],exports.modules={31633:(e,t,n)=>{"use strict";var i=n(12781).Stream,r=n(73837),s=n(16778),o=n(3355),a=n(50490),h=n(68435),l=n(31436),u=function(e,t,n){this.writable=!0,n=n||{},this._stream=t.socket,this._ping=n.ping||this.DEFAULT_PING,this._retry=n.retry||this.DEFAULT_RETRY;var i=s.isSecureRequest(e)?"https:":"http:";this.url=i+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=a.CONNECTING;var r=new o,h=this;if(n.headers)for(var l in n.headers)r.set(l,n.headers[l]);if(this._stream&&this._stream.writable){process.nextTick(function(){h._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var u="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+r.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(u),this._stream.on("drain",function(){h.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){h.ping()},1e3*this._ping)),["error","end"].forEach(function(e){h._stream.on(e,function(){h.close()})})}};r.inherits(u,i),u.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var c={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===a.CONNECTING){this.readyState=a.OPEN;var e=new l("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>a.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var n="";return(t=t||{}).event&&(n+="event: "+t.event+"\r\n"),t.id&&(n+="id: "+t.id+"\r\n"),n+="data: "+e+"\r\n\r\n",this._write(n)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>a.OPEN)return!1;this.readyState=a.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new l("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var d in c)u.prototype[d]=c[d];for(var p in h)u.prototype[p]=h[p];e.exports=u},81453:(e,t,n)=>{"use strict";var i=n(73837),r=n(16778),s=n(50490),o=function(e,t,n,i,o){o=o||{},this._stream=t,this._driver=r.http(e,{maxLength:o.maxLength,protocols:i});var a=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var h=function(){a._stream.removeListener("data",h)};this._stream.on("data",h),s.call(this,o),process.nextTick(function(){a._driver.start(),a._driver.io.write(n)})}};i.inherits(o,s),o.isWebSocket=function(e){return r.isWebSocket(e)},o.validateOptions=function(e,t){r.validateOptions(e,t)},o.WebSocket=o,o.Client=n(9131),o.EventSource=n(31633),e.exports=o},50490:(e,t,n)=>{"use strict";var i=n(12781).Stream,r=n(73837),s=n(16778),o=n(68435),a=n(31436),h=function(e){e=e||{},s.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var n in t)this._driver.setHeader(n,t[n]);var i=e.extensions;i&&[].concat(i).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=h.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var r=this;this._driver.on("open",function(e){r._open()}),this._driver.on("message",function(e){r._receiveMessage(e.data)}),this._driver.on("close",function(e){r._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){r._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){r.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){r._pingId+=1,r.ping(r._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};r.inherits(h,i),h.CONNECTING=0,h.OPEN=1,h.CLOSING=2,h.CLOSED=3,h.CLOSE_TIMEOUT=3e4;var l={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>h.OPEN)&&(e instanceof Buffer||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>h.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<h.CLOSING){var n=this;this._closeTimer=setTimeout(function(){n._beginClose("",1006)},h.CLOSE_TIMEOUT)}this.readyState!==h.CLOSED&&(this.readyState=h.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN,this.protocol=this._driver.protocol||"";var e=new a("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>h.OPEN)return!1;this.readable&&this.emit("data",e);var t=new a("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=h.CLOSING)){var t=new a("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==h.CLOSED&&(this.readyState=h.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==h.CLOSED){this.readyState=h.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=new a("close",{code:this._closeParams?this._closeParams[1]:1006,reason:e});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(var u in l)h.prototype[u]=l[u];for(var c in o)h.prototype[c]=o[c];e.exports=h},31436:e=>{"use strict";var t=function(e,t){for(var n in this.type=e,t)this[n]=t[n]};t.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},t.prototype.stopPropagation=function(){},t.prototype.preventDefault=function(){},t.CAPTURING_PHASE=1,t.AT_TARGET=2,t.BUBBLING_PHASE=3,e.exports=t},68435:(e,t,n)=>{"use strict";var i=n(31436);e.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,n){this.on(e,t)},removeEventListener:function(e,t,n){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=i.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}}},9131:(e,t,n)=>{"use strict";var i=n(73837),r=n(41808),s=n(24404),o=n(57310),a=n(16778),h=n(50490);n(31436);var l={"http:":80,"https:":443,"ws:":80,"wss:":443},u=["https:","wss:"],c=function(e,t,n){n=n||{},this.url=e,this._driver=a.client(this.url,{maxLength:n.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){y.headers=y._driver.headers,y.statusCode=y._driver.statusCode})},this);var i=n.proxy||{},c=o.parse(i.origin||this.url),d=c.port||l[c.protocol],p=u.indexOf(c.protocol)>=0,_=function(){y._onConnect()},f=n.net||{},g=n.tls||{},m=i.origin?i.tls||{}:g,y=this;f.host=m.host=c.hostname,f.port=m.port=d,g.ca=g.ca||n.ca,m.servername=m.servername||c.hostname,this._stream=p?s.connect(m,_):r.connect(f,_),i.origin&&this._configureProxy(i,g),h.call(this,n)};i.inherits(c,h),c.prototype._onConnect=function(){(this._proxy||this._driver).start()},c.prototype._configureProxy=function(e,t){var n,i=o.parse(this.url),r=u.indexOf(i.protocol)>=0,a=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(n in e.headers)this._proxy.setHeader(n,e.headers[n]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(r){var e={socket:a._stream,servername:i.hostname};for(n in t)e[n]=t[n];a._stream=s.connect(e),a._configureStream()}a._driver.io.pipe(a._stream),a._stream.pipe(a._driver.io),a._driver.start()}),this._proxy.on("error",function(e){a._driver.emit("error",e)})},e.exports=c},22735:(e,t,n)=>{var i=n(39491);function r(e){i.ok(e===r.REQUEST||e===r.RESPONSE||void 0===e),void 0===e||this.initialize(e),this.maxHeaderSize=r.maxHeaderSize}t.m=r,r.prototype.initialize=function(e,t){i.ok(e===r.REQUEST||e===r.RESPONSE),this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},r.encoding="ascii",r.maxHeaderSize=81920,r.REQUEST="REQUEST",r.RESPONSE="RESPONSE";var s=r.kOnHeaders=1,o=r.kOnHeadersComplete=2,a=r.kOnBody=3,h=r.kOnMessageComplete=4;r.prototype[s]=r.prototype[o]=r.prototype[a]=r.prototype[h]=function(){};var l=!0;Object.defineProperty(r,"kOnExecute",{get:function(){return l=!1,99}});var u=r.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],c=u.indexOf("CONNECT");r.prototype.reinitialize=r,r.prototype.close=r.prototype.pause=r.prototype.resume=r.prototype.free=function(){},r.prototype._compatMode0_11=!1,r.prototype.getAsyncId=function(){return 0};var d={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};r.prototype.execute=function(e,t,n){if(!(this instanceof r))throw TypeError("not a HTTPParser");t=t||0,n="number"==typeof n?n:e.length,this.chunk=e,this.offset=t;var i=this.end=t+n;try{for(;this.offset<i&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,n=this.offset-t,d[this.state]&&(this.headerSize+=n,this.headerSize>(this.maxHeaderSize||r.maxHeaderSize)))?Error("max header size exceeded"):n};var p={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};r.prototype.finish=function(){if(!this.hadError){if(!p[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[h]())}},r.prototype.consume=r.prototype.unconsume=r.prototype.getCurrentBuffer=function(){},r.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},r.prototype.nextRequest=function(){this.userCall()(this[h]()),this.reinitialize(this.type)},r.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,n=this.offset;n<e;n++)if(10===t[n]){var i=this.line+t.toString(r.encoding,this.offset,n);return"\r"===i.charAt(i.length-1)&&(i=i.substr(0,i.length-1)),this.line="",this.offset=n+1,i}this.line+=t.toString(r.encoding,this.offset,this.end),this.offset=this.end};var _=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,f=/^[ \t]+(.*[^ \t])/;r.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw y("HPE_LF_EXPECTED");var n=_.exec(e),i=n&&n[1];if(i)t.push(i),t.push(n[2]);else{var r=f.exec(e);r&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=r[1])}};var g=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;r.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=g.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:u.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var m=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function y(e){var t=Error("Parse Error");return t.code=e,t}r.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=m.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var n=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((n/100|0)==1||204===n||304===n)&&(this.body_bytes=0),this.state="HEADER"}},r.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},r.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var n,i,s=t.headers,a=!1,h=!1,u=0;u<s.length;u+=2)switch(s[u].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===s[u+1].toLowerCase();break;case"content-length":if(n=+s[u+1],a){if(n!==this.body_bytes)throw y("HPE_UNEXPECTED_CONTENT_LENGTH")}else a=!0,this.body_bytes=n;break;case"connection":this.connection+=s[u+1].toLowerCase();break;case"upgrade":h=!0}if(this.isChunked&&a&&(a=!1,this.body_bytes=null),h&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===r.REQUEST||101===t.statusCode:t.upgrade=t.method===c,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(i=l?this.userCall()(this[o](t)):this.userCall()(this[o](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!i)this.state="BODY_CHUNKHEAD";else{if(i||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},r.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},r.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},r.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();void 0!==e&&(i.equal(e,""),this.state="BODY_CHUNKHEAD")},r.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[s](this.trailers,"")),this.nextRequest()))},r.prototype.BODY_RAW=function(){var e=this.end-this.offset;this.userCall()(this[a](this.chunk,this.offset,e)),this.offset=this.end},r.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=r["kOn"+e];Object.defineProperty(r.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,c="CONNECT",this[t]=e}})})},5299:(e,t,n)=>{"use strict";/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var i=n(14300),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=o),o.prototype=Object.create(r.prototype),s(r,o),o.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i.SlowBuffer(e)}},16778:(e,t,n)=>{"use strict";var i=n(30533),r=n(75409),s=n(69588);e.exports={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new r(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new s(e)},http:function(){return s.http.apply(s,arguments)},isSecureRequest:function(e){return s.isSecureRequest(e)},isWebSocket:function(e){return i.isWebSocket(e)},validateOptions:function(e,t){i.validateOptions(e,t)}}},30533:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=n(82361).EventEmitter,s=n(73837),o=n(85340),a=n(3355),h=n(31162),l=function(e,t,n){r.call(this),l.validateOptions(n||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new h,this._options=n||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new a,this.__queue=[],this.readyState=0,this.url=t,this.io=new o.IO(this),this.messages=new o.Messages(this),this._bindEventListeners()};s.inherits(l,r),l.isWebSocket=function(e){var t=e.headers.connection||"",n=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===n.toLowerCase()},l.validateOptions=function(e,t){for(var n in e)if(0>t.indexOf(n))throw Error("Unrecognized option: "+n)};var u={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var n=e.messages;n.readable&&n.emit("data",t.data)}),this.on("error",function(t){var n=e.messages;n.readable&&n.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!l.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new a;return t.set("Content-Type","text/plain"),t.set("Content-Length",i.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(i.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new l.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new l.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var c in u)l.prototype[c]=u[c];l.ConnectEvent=function(){},l.OpenEvent=function(){},l.CloseEvent=function(e,t){this.code=e,this.reason=t},l.MessageEvent=function(e){this.data=e},l.PingEvent=function(e){this.data=e},l.PongEvent=function(e){this.data=e},e.exports=l},75409:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=n(6113),s=n(57310),o=n(73837),a=n(3515),h=n(30533),l=n(28388),u=n(74887),c=function(e,t){this.version="hybi-"+l.VERSION,l.call(this,null,e,t),this.readyState=-1,this._key=c.generateKey(),this._accept=l.generateAccept(this._key),this._http=new a("response");var n=s.parse(this.url),r=n.auth&&i.from(n.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(n.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(n.pathname||"/")+(n.search||""),this._headers.set("Host",n.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",l.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),r&&this._headers.set("Authorization","Basic "+r)};o.inherits(c,l),c.generateKey=function(){return r.randomBytes(16).toString("base64")};var d={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new u(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){if(3!==this.readyState){if(this.readyState>0)return l.prototype.parse.call(this,e);this._http.parse(e),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return i.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new h.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",n=e.connection||"",i=e["sec-websocket-accept"]||"",r=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===n)return this._failHandshake("'Connection' header is missing");if("upgrade"!==n.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(i!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==r){if(0>this._protocols.indexOf(r))return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=r}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var p in d)c.prototype[p]=d[p];e.exports=c},55131:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=n(30533),s=n(73837),o=function(e,t,n){r.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};s.inherits(o,r);var a={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new r.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=i.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new r.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=i.byteLength(e),n=i.allocUnsafe(t+2);return n[0]=0,n.write(e,1),n[n.length-1]=255,this._write(n),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return i.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var h in a)o.prototype[h]=a[h];e.exports=o},25377:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=n(30533),s=n(55131),o=n(6113),a=n(73837),h=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},l=function(e){return(e.match(/ /g)||[]).length},u=function(e,t,n){s.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};a.inherits(u,s);var c={BODY_SIZE:8,start:function(){return!!s.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(i.from([255,0])),this.readyState=3,this.emit("close",new r.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],n=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!n)throw Error("Missing required header: Sec-WebSocket-Key2");var r=h(t),s=l(t),o=h(n),a=l(n);if(r%s!=0||o%a!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[r/s,o/a];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return i.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=o.createHash("md5"),t=i.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),i.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),i.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return s.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var d in c)u.prototype[d]=c[d];e.exports=u},3355:e=>{"use strict";var t=function(){this.clear()};t.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],t.prototype.clear=function(){this._sent={},this._lines=[]},t.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var n=e.toLowerCase();(!this._sent.hasOwnProperty(n)||this.ALLOWED_DUPLICATES.indexOf(n)>=0)&&(this._sent[n]=!0,this._lines.push(e+": "+t+"\r\n"))}},t.prototype.toString=function(){return this._lines.join("")},t.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")},e.exports=t},28388:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=n(6113),s=n(73837),o=n(27999),a=n(30533),h=n(84643),l=n(61357),u=function(e,t,n){if(a.apply(this,arguments),this._extensions=new o,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var i=this._request.headers["sec-websocket-protocol"],r=this._protocols;void 0!==i&&("string"==typeof i&&(i=i.split(/ *, */)),this.protocol=i.filter(function(e){return r.indexOf(e)>=0})[0]),this.version="hybi-"+u.VERSION}};s.inherits(u,a),u.VERSION="13",u.mask=function(e,t,n){if(!t||0===t.length)return e;n=n||0;for(var i=0,r=e.length-n;i<r;i++)e[n+i]=e[n+i]^t[i%4];return e},u.generateAccept=function(e){var t=r.createHash("sha1");return t.update(e+u.GUID),t.digest("base64")},u.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var c={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new a.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,n){if(this.readyState<=0)return this._queue([e,t,n]);if(this.readyState>2)return!1;e instanceof Array&&(e=i.from(e)),"number"==typeof e&&(e=e.toString());var s,o,a=new l,u="string"==typeof e;a.rsv1=a.rsv2=a.rsv3=!1,a.opcode=this.OPCODES[t||(u?"text":"binary")],s=u?i.from(e,"utf8"):e,n&&(o=s,(s=i.allocUnsafe(2+o.length)).writeUInt16BE(n,0),o.copy(s,2)),a.data=s;var c=function(e){var t=new h;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=r.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(a.opcode)>=0?this._extensions.processOutgoingMessage(a,function(e,t){if(e)return this._fail("extension_error",e.message);c.call(this,t)},this):c.call(this,a),!0},_sendFrame:function(e){var t=e.length,n=t<=125?2:t<=65535?4:10,r=n+(e.masked?4:0),s=i.allocUnsafe(r+t),o=e.masked?this.MASK:0;s[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?s[1]=o|t:t<=65535?(s[1]=126|o,s.writeUInt16BE(t,2)):(s[1]=127|o,s.writeUInt32BE(Math.floor(t/4294967296),2),s.writeUInt32BE(t%4294967296,6)),e.payload.copy(s,r),e.masked&&(e.maskingKey.copy(s,n),u.mask(s,e.maskingKey,r)),this._write(s)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==u.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",u.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var n=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);n&&this._headers.set("Sec-WebSocket-Extensions",n);var r=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return i.from(r.join("\r\n"),"utf8")},_shutdown:function(e,t,n){delete this._frame,delete this._message,this._stage=5;var i=1===this.readyState;this.readyState=2,this._extensions.close(function(){i&&this.frame(t,"close",e),this.readyState=3,n&&this.emit("error",Error(t)),this.emit("close",new a.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),n=this._frame=new h;return(n.final=(e&this.FIN)===this.FIN,n.rsv1=t[0],n.rsv2=t[1],n.rsv3=t[2],n.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(n))?0>this.OPCODE_CODES.indexOf(n.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+n.opcode):0>this.MESSAGE_OPCODES.indexOf(n.opcode)&&!n.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+n.opcode):this._message&&this.OPENING_OPCODES.indexOf(n.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(n.rsv1?1:0)+", reserved2 = "+(n.rsv2?1:0)+", reserved3 = "+(n.rsv3?1:0))},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,n,i,r,s,o=this._frame,h=o.payload=u.mask(e,o.maskingKey),c=o.opcode;if(delete this._frame,c===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(o)}if((c===this.OPCODES.text||c===this.OPCODES.binary)&&(this._message=new l,this._message.pushFrame(o)),o.final&&this.MESSAGE_OPCODES.indexOf(c)>=0)return this._emitMessage(this._message);c===this.OPCODES.close&&(n=h.length>=2?h.readUInt16BE(0):null,i=h.length>2?this._encode(h.slice(2)):null,0!==h.length&&!(null!==n&&n>=this.MIN_RESERVED_ERROR&&n<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(n)&&(n=this.ERRORS.protocol_error),(h.length>125||h.length>2&&!i)&&(n=this.ERRORS.protocol_error),this._shutdown(n||this.DEFAULT_ERROR_CODE,i||"")),c===this.OPCODES.ping&&(this.frame(h,"pong"),this.emit("ping",new a.PingEvent(h.toString()))),c===this.OPCODES.pong&&(s=(r=this._pingCallbacks)[t=this._encode(h)],delete r[t],s&&s(),this.emit("pong",new a.PongEvent(h.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var n=t.data;if(t.opcode===this.OPCODES.text&&(n=this._encode(n)),null===n)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new a.MessageEvent(n))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):4294967296*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var d in c)u.prototype[d]=c[d];e.exports=u},84643:e=>{"use strict";var t=function(){},n={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var i in n)t.prototype[i]=n[i];e.exports=t},61357:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},s={read:function(){return this.data=this.data||i.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var o in s)r.prototype[o]=s[o];e.exports=r},74887:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=n(12781).Stream,s=n(57310),o=n(73837),a=n(30533),h=n(3355),l=n(3515),u={"ws:":80,"wss:":443},c=function(e,t,n){this._client=e,this._http=new l("response"),this._origin="object"==typeof e.url?e.url:s.parse(e.url),this._url="object"==typeof t?t:s.parse(t),this._options=n||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new h,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var r=this._url.auth&&i.from(this._url.auth,"utf8").toString("base64");r&&this._headers.set("Proxy-Authorization","Basic "+r)};o.inherits(c,r);var d={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||u[e.protocol],n=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",i.from(n.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new a.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var p in d)c.prototype[p]=d[p];e.exports=c},69588:(e,t,n)=>{"use strict";var i=n(73837),r=n(3515),s=n(30533),o=n(55131),a=n(25377),h=n(28388),l=function(e){s.call(this,null,null,e),this._http=new r("request")};i.inherits(l,s);var u={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=l.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(n){t.emit(e,n)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new s.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var c in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){u[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),u)l.prototype[c]=u[c];l.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},l.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},l.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var n=e.headers,i=n["sec-websocket-version"],r=n["sec-websocket-key"],s=n["sec-websocket-key1"],l=n["sec-websocket-key2"],u=this.determineUrl(e);return i||r?new h(e,u,t):s||l?new a(e,u,t):new o(e,u,t)},e.exports=l},31162:(e,t,n)=>{"use strict";var i=n(5299).Buffer,r=function(){this._queue=[],this._queueSize=0,this._offset=0};r.prototype.put=function(e){e&&0!==e.length&&(i.isBuffer(e)||(e=i.from(e)),this._queue.push(e),this._queueSize+=e.length)},r.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return i.alloc(0);this._queueSize-=e;var t,n,r=this._queue,s=e,o=r[0];if(o.length>=e)return o.length===e?r.shift():(n=o.slice(0,e),r[0]=o.slice(e),n);for(var a=0,h=r.length;a<h&&!(s<r[a].length);a++)s-=r[a].length;return t=r.splice(0,a),s>0&&r.length>0&&(t.push(r[0].slice(0,s)),r[0]=r[0].slice(s)),i.concat(t,e)},r.prototype.eachByte=function(e,t){for(var n,i,r;this._queue.length>0;){for(i=(n=this._queue[0]).length;this._offset<i;)r=this._offset,this._offset+=1,e.call(t,n[r]);this._offset=0,this._queue.shift()}},e.exports=r},3515:(e,t,n)=>{"use strict";var i=n(22735).m,r=n(5299).Buffer,s={request:i.REQUEST||"request",response:i.RESPONSE||"response"},o=function(e){this._type=e,this._parser=new i(s[e]),this._complete=!1,this.headers={};var t=null,n=this;this._parser.onHeaderField=function(e,n,i){t=e.toString("utf8",n,n+i).toLowerCase()},this._parser.onHeaderValue=function(e,i,r){var s=e.toString("utf8",i,i+r);n.headers.hasOwnProperty(t)?n.headers[t]+=", "+s:n.headers[t]=s},this._parser.onHeadersComplete=this._parser[i.kOnHeadersComplete]=function(e,t,i,r,s,a){var h=arguments[0];if("object"==typeof h&&(r=h.method,s=h.url,a=h.statusCode,i=h.headers),n.method="number"==typeof r?o.METHODS[r]:r,n.statusCode=a,n.url=s,i){for(var l,u,c=0,d=i.length;c<d;c+=2)l=i[c].toLowerCase(),u=i[c+1],n.headers.hasOwnProperty(l)?n.headers[l]+=", "+u:n.headers[l]=u;n._complete=!0}}};o.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var a=process.version?process.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===a[0]&&12===a[1]&&(o.METHODS[16]="REPORT",o.METHODS[17]="MKACTIVITY",o.METHODS[18]="CHECKOUT",o.METHODS[19]="MERGE",o.METHODS[20]="M-SEARCH",o.METHODS[21]="NOTIFY",o.METHODS[22]="SUBSCRIBE",o.METHODS[23]="UNSUBSCRIBE",o.METHODS[24]="PATCH",o.METHODS[25]="PURGE"),o.prototype.isComplete=function(){return this._complete},o.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):r.alloc(0))},e.exports=o},85340:(e,t,n)=>{"use strict";var i=n(12781).Stream,r=n(73837),s=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};r.inherits(s,i),s.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},s.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},s.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},s.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},s.prototype.destroy=function(){this.end()};var o=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};r.inherits(o,i),o.prototype.pause=function(){this._driver.io._paused=!0},o.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},o.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},o.prototype.end=function(e){void 0!==e&&this.write(e)},o.prototype.destroy=function(){},t.IO=s,t.Messages=o},76172:e=>{"use strict";var t=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,n=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,i=RegExp(t.source+"(?:=(?:"+t.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),r=RegExp(t.source+"(?: *; *"+i.source+")*","g"),s=RegExp("^"+r.source+"(?: *, *"+r.source+")*$"),o=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,a=Object.prototype.hasOwnProperty,h=function(){this._byName={},this._inOrder=[]};h.prototype.push=function(e,t){a.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},h.prototype.eachOffer=function(e,t){for(var n=this._inOrder,i=0,r=n.length;i<r;i++)e.call(t,n[i].name,n[i].params)},h.prototype.byName=function(e){return this._byName[e]||[]},h.prototype.toArray=function(){return this._inOrder.slice()},e.exports={parseHeader:function(e){var t=new h;if(""===e||void 0===e)return t;if(!s.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(r).forEach(function(e){var n=e.match(RegExp(i.source,"g")),r=n.shift(),s={};n.forEach(function(e){var t,n=e.match(i),r=n[1];t=void 0!==n[2]?n[2]:void 0===n[3]||n[3].replace(/\\/g,""),o.test(t)&&(t=parseFloat(t)),a.call(s,r)?(s[r]=[].concat(s[r]),s[r].push(t)):s[r]=t},this),t.push(r,s)},this),t},serializeParams:function(e,t){var i=[],r=function(e,t){t instanceof Array?t.forEach(function(t){r(e,t)}):!0===t?i.push(e):"number"==typeof t?i.push(e+"="+t):n.test(t)?i.push(e+'="'+t.replace(/"/g,'\\"')+'"'):i.push(e+"="+t)};for(var s in t)r(s,t[s]);return[e].concat(i).join("; ")}}},7902:(e,t,n)=>{"use strict";var i=n(9432),r=n(69321),s=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new i(this._session,"processIncomingMessage"),outgoing:new i(this._session,"processOutgoingMessage")}};s.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},s.prototype.incoming=function(e,t,n,i){this._exec("incoming",e,t,n,i)},s.prototype.outgoing=function(e,t,n,i){this._exec("outgoing",e,t,n,i)},s.prototype.close=function(){return this._closed=this._closed||new r,this._doClose(),this._closed},s.prototype._exec=function(e,t,n,i,r){this._functors[e].call(t,n,function(e,t){e&&(e.message=this._ext.name+": "+e.message),i.call(r,e,t),this._doClose()},this)},s.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},e.exports=s},9432:(e,t,n)=>{"use strict";var i=n(25673),r=function(e,t){this._session=e,this._method=t,this._queue=new i(r.QUEUE_SIZE),this._stopped=!1,this.pending=0};r.QUEUE_SIZE=8,r.prototype.call=function(e,t,n,i){if(!this._stopped){var r={error:e,message:t,callback:n,context:i,done:!1},s=!1,o=this;if(this._queue.push(r),r.error)return r.done=!0,this._stop(),this._flushQueue();var a=function(e,t){s^(s=!0)&&(e?(o._stop(),r.error=e,r.message=null):r.message=t,r.done=!0,o._flushQueue())};try{this._session[this._method](t,a)}catch(e){a(e)}}},r.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},r.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)},e.exports=r},41425:(e,t,n)=>{"use strict";var i=n(7902),r=n(69321),s=function(e){this._cells=e.map(function(e){return new i(e)}),this._stopped={incoming:!1,outgoing:!1}};s.prototype.processIncomingMessage=function(e,t,n){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,n)},s.prototype.processOutgoingMessage=function(e,t,n){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,n)},s.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var n=this._cells.map(function(e){return e.close()});e&&r.all(n).then(function(){e.call(t)})},s.prototype._loop=function(e,t,n,i,r,s,o){for(var a=this._cells,h=a.length,l=this;h--;)a[h].pending(e);var u=function(t,r,h){if(t===n)return s.call(o,r,h);a[t][e](r,h,function(n,r){n&&(l._stopped[e]=!0),u(t+i,n,r)})};u(t,null,r)},e.exports=s},69321:(e,t,n)=>{"use strict";var i=n(25673),r=function(){this._complete=!1,this._callbacks=new i(r.QUEUE_SIZE)};r.QUEUE_SIZE=4,r.all=function(e){var t=new r,n=e.length,i=n;for(0===n&&t.done();i--;)e[i].then(function(){0==(n-=1)&&t.done()});return t},r.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},r.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()},e.exports=r},25673:e=>{"use strict";var t=function(e){this._bufferSize=e,this.clear()};t.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},t.prototype.push=function(e){var t=!1,n=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,n=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,n&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},t.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},t.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}},e.exports=t},27999:(e,t,n)=>{"use strict";var i=n(76172),r=n(41425),s=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};s.MESSAGE_OPCODES=[1,2];var o={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],n={};return this._inOrder.forEach(function(r){var s=r.createClientSession();if(s){var o=[r,s];e.push(o),n[r.name]=o;var a=s.generateOffer();(a=a?[].concat(a):[]).forEach(function(e){t.push(i.serializeParams(r.name,e))},this)}},this),this._sessions=e,this._index=n,t.length>0?t.join(", "):null},activate:function(e){var t=i.parseHeader(e),n=[];t.eachOffer(function(e,t){var r=this._index[e];if(!r)throw Error('Server sent an extension response for unknown extension "'+e+'"');var s=r[0],o=r[1],a=this._reserved(s);if(a)throw Error("Server sent two extension responses that use the RSV"+a[0]+' bit: "'+a[1]+'" and "'+s.name+'"');if(!0!==o.activate(t))throw Error("Server sent unacceptable extension parameters: "+i.serializeParams(e,t));this._reserve(s),n.push(r)},this),this._sessions=n,this._pipeline=new r(n)},generateResponse:function(e){var t=[],n=[],s=i.parseHeader(e);return this._inOrder.forEach(function(e){var r=s.byName(e.name);if(!(0===r.length||this._reserved(e))){var o=e.createServerSession(r);o&&(this._reserve(e),t.push([e,o]),n.push(i.serializeParams(e.name,o.generateResponse())))}},this),this._sessions=t,this._pipeline=new r(t),n.length>0?n.join(", "):null},validFrameRsv:function(e){var t,n={rsv1:!1,rsv2:!1,rsv3:!1};if(s.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var i=0,r=this._sessions.length;i<r;i++)t=this._sessions[i][0],n.rsv1=n.rsv1||t.rsv1,n.rsv2=n.rsv2||t.rsv2,n.rsv3=n.rsv3||t.rsv3;return(n.rsv1||!e.rsv1)&&(n.rsv2||!e.rsv2)&&(n.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,n){this._pipeline.processIncomingMessage(e,t,n)},processOutgoingMessage:function(e,t,n){this._pipeline.processOutgoingMessage(e,t,n)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var a in o)s.prototype[a]=o[a];e.exports=s},69429:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(36348),r=n(47059),s=n(95285),o=n(71954);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new r.wA("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate)))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();let i=this._delegate.container.getProvider(e);return i.isInitialized()||(null===(n=i.getComponent())||void 0===n?void 0:n.instantiationMode)!=="EXPLICIT"||i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}let h=new i.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),l=/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e(){let t=/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){let t={},n={__esModule:!0,initializeApp:function(r,o={}){let a=s.initializeApp(r,o);if((0,i.r3)(t,a.name))return t[a.name];let h=new e(a,n);return t[a.name]=h,h},app:r,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){let o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){let s=(e=r())=>{if("function"!=typeof e[a])throw h.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,i.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,o).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function r(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,i.r3)(t,e))throw h.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map(e=>t[e])}}),r.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,i.ZB)(t,e)},createSubscribe:i.ne,ErrorFactory:i.LL,deepExtend:i.ZB}),t}(),u=new o.Yd("@firebase/app-compat");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if((0,i.jU)()&&void 0!==self.firebase){u.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);let e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&u.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}let c=l;(0,s.registerVersion)("@firebase/app-compat","0.2.29",void 0)},95285:(e,t,n)=>{"use strict";let i,r;n.r(t),n.d(t,{FirebaseError:()=>h.ZR,SDK_VERSION:()=>q,_DEFAULT_ENTRY_NAME:()=>I,_addComponent:()=>P,_addOrOverwriteComponent:()=>O,_apps:()=>x,_clearComponents:()=>L,_components:()=>N,_getProvider:()=>D,_registerComponent:()=>R,_removeServiceInstance:()=>A,deleteApp:()=>W,getApp:()=>U,getApps:()=>H,initializeApp:()=>B,onLog:()=>V,registerVersion:()=>j,setLogLevel:()=>z});var s,o=n(47059),a=n(71954),h=n(36348);let l=(e,t)=>t.some(t=>e instanceof t),u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,_=new WeakMap,f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||d.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function g(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(g(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&u.set(t,e)}).catch(()=>{}),_.set(t,e),t}(e);if(p.has(e))return p.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(m(this),e),g(u.get(this))}:function(...e){return g(t.apply(m(this),e))}:function(e,...n){let i=t.call(m(this),e,...n);return d.set(i,e.sort?e.sort():[e]),g(i)}:(t instanceof IDBTransaction&&function(e){if(c.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});c.set(e,t)}(t),l(t,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,f):t;return n!==e&&(p.set(e,n),_.set(n,e)),n}let m=e=>_.get(e),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],b=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(b.get(t))return b.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=v.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||y.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return b.set(t,s),s}f={...s=f,get:(e,t,n)=>C(e,t)||s.get(e,t,n),has:(e,t)=>!!C(e,t)||s.has(e,t)};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let w="@firebase/app",S="0.9.29",T=new a.Yd("@firebase/app"),I="[DEFAULT]",k={[w]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},x=new Map,N=new Map;function P(e,t){try{e.container.addComponent(t)}catch(n){T.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function O(e,t){e.container.addOrOverwriteComponent(t)}function R(e){let t=e.name;if(N.has(t))return T.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(N.set(t,e),x.values()))P(n,e);return!0}function D(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function A(e,t,n=I){D(e,t).clearInstance(n)}function L(){N.clear()}let M=new h.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new o.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw M.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let q="10.9.0";function B(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:I,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw M.create("bad-app-name",{appName:String(r)});if(n||(n=(0,h.aH)()),!n)throw M.create("no-options");let s=x.get(r);if(s){if((0,h.vZ)(n,s.options)&&(0,h.vZ)(i,s.config))return s;throw M.create("duplicate-app",{appName:r})}let a=new o.H0(r);for(let e of N.values())a.addComponent(e);let l=new F(n,i,a);return x.set(r,l),l}function U(e=I){let t=x.get(e);if(!t&&e===I&&(0,h.aH)())return B();if(!t)throw M.create("no-app",{appName:e});return t}function H(){return Array.from(x.values())}async function W(e){let t=e.name;x.has(t)&&(x.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function j(e,t,n){var i;let r=null!==(i=k[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);let s=r.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${r}" with version "${t}":`];s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),T.warn(e.join(" "));return}R(new o.wA(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function V(e,t){if(null!==e&&"function"!=typeof e)throw M.create("invalid-log-argument");(0,a.Am)(e,t)}function z(e){(0,a.Ub)(e)}let K="firebase-heartbeat-store",Y=null;function $(){return Y||(Y=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=g(o);return i&&o.addEventListener("upgradeneeded",e=>{i(g(o.result),e.oldVersion,e.newVersion,g(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(K)}catch(e){console.warn(e)}}}).catch(e=>{throw M.create("idb-open",{originalErrorMessage:e.message})})),Y}async function Q(e){try{let t=(await $()).transaction(K),n=await t.objectStore(K).get(Z(e));return await t.done,n}catch(e){if(e instanceof h.ZR)T.warn(e.message);else{let t=M.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});T.warn(t.message)}}}async function G(e,t){try{let n=(await $()).transaction(K,"readwrite"),i=n.objectStore(K);await i.put(t,Z(e)),await n.done}catch(e){if(e instanceof h.ZR)T.warn(e.message);else{let t=M.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});T.warn(t.message)}}}function Z(e){return`${e.name}!${e.options.appId}`}class J{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ee(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=X();return(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)?void 0:this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=X(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),et(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),et(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=(0,h.L)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function X(){return new Date().toISOString().substring(0,10)}class ee{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,h.hl)()&&(0,h.eu)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await Q(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return G(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return G(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function et(e){return(0,h.L)(JSON.stringify({version:2,heartbeats:e})).length}R(new o.wA("platform-logger",e=>new E(e),"PRIVATE")),R(new o.wA("heartbeat",e=>new J(e),"PRIVATE")),j(w,S,""),j(w,S,"esm2017"),j("fire-js","")},47059:(e,t,n)=>{"use strict";n.d(t,{H0:()=>a,wA:()=>r,zt:()=>o});var i=n(36348);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new i.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:e===s?void 0:e,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},71954:(e,t,n)=>{"use strict";var i;n.d(t,{Am:()=>c,Ub:()=>u,Yd:()=>l,in:()=>i});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));let s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},h=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=a[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class l{constructor(e){this.name=e,this._logLevel=o,this._logHandler=h,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function u(e){r.forEach(t=>{t.setLogLevel(e)})}function c(e,t){for(let n of r){let r=null;t&&t.level&&(r=s[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...s)=>{let o=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:o,args:s,type:t.name})}}}},36348:(e,t,n)=>{"use strict";n.d(t,{BH:()=>b,DV:()=>F,Dv:()=>K,GJ:()=>L,L:()=>c,LL:()=>N,Sg:()=>C,UI:()=>B,US:()=>h,Wj:()=>$,Wl:()=>R,Yr:()=>T,ZB:()=>_,ZR:()=>x,aH:()=>v,b$:()=>S,cI:()=>O,dS:()=>G,eu:()=>k,g5:()=>s,gK:()=>Y,gQ:()=>W,h$:()=>u,hl:()=>I,hu:()=>r,jU:()=>w,lb:()=>Q,m9:()=>J,ne:()=>j,p$:()=>p,r3:()=>M,uI:()=>E,ug:()=>Z,vZ:()=>function e(t,n){if(t===n)return!0;let i=Object.keys(t),r=Object.keys(n);for(let s of i){if(!r.includes(s))return!1;let i=t[s],o=n[s];if(U(i)&&U(o)){if(!e(i,o))return!1}else if(i!==o)return!1}for(let e of r)if(!i.includes(e))return!1;return!0},w9:()=>A,xO:()=>H,xb:()=>q});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},r=function(e,t){if(!e)throw s(t)},s=function(e){return Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},o=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},a=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,h=a?e[t+2]:0,l=r>>2,u=(3&r)<<4|o>>4,c=(15&o)<<2|h>>6,d=63&h;a||(d=64,s||(c=64)),i.push(n[l],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(o(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new l;let h=r<<2|s>>4;if(i.push(h),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let u=function(e){let t=o(e);return h.encodeByteArray(t,!0)},c=function(e){return u(e).replace(/\./g,"")},d=function(e){try{return h.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p(e){return _(void 0,e)}function _(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(let n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=_(e[n],t[n]));return e}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f=()=>/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,g=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&d(e[1]);return t&&JSON.parse(t)},y=()=>{try{return f()||g()||m()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},v=()=>{var e;return null===(e=y())||void 0===e?void 0:e.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[c(JSON.stringify({alg:"none",type:"JWT"})),c(JSON.stringify(s)),""].join(".")}function E(){return!1}function w(){return"object"==typeof self&&self.self===self}function S(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function T(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}function I(){try{return"object"==typeof indexedDB}catch(e){return!1}}function k(){return new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}class x extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,N.prototype.create)}}class N{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?r.replace(P,(e,t)=>{let i=n[t];return null!=i?String(i):`<${t}?>`}):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new x(i,o,n)}}let P=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O(e){return JSON.parse(e)}function R(e){return JSON.stringify(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let D=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=O(d(s[0])||""),n=O(d(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},A=function(e){let t=D(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},L=function(e){let t=D(e).claims;return"object"==typeof t&&!0===t.admin};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function q(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function B(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function U(e){return null!==e&&"object"==typeof e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=h^o&(a^h),i=1518500249):(n=o^a^h,i=1859775393):e<60?(n=o&a|h&(o|a),i=2400959708):(n=o^a^h,i=3395469782);let t=(s<<5|s>>>27)+n+l+i+r[e]&4294967295;l=h,h=a,a=(o<<30|o>>>2)&4294967295,o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function j(e,t){let n=new V(e,t);return n.subscribe.bind(n)}class V{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=z),void 0===i.error&&(i.error=z),void 0===i.complete&&(i.complete=z);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function z(){}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K=function(e,t,n,i){let r;if(i<t?r="at least "+t:i>n&&(r=0===n?"none":"no more than "+n),r)throw Error(e+" failed: Was called with "+i+(1===i?" argument.":" arguments.")+" Expects "+r+".")};function Y(e,t){return`${e} failed: ${t} argument `}function $(e,t,n,i){if((!i||n)&&"function"!=typeof n)throw Error(Y(e,t)+"must be a valid function.")}function Q(e,t,n,i){if((!i||n)&&("object"!=typeof n||null===n))throw Error(Y(e,t)+"must be a valid context object.")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let G=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){let t=s-55296;r(++i<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(i)-56320)}s<128?t[n++]=s:(s<2048?t[n++]=s>>6|192:(s<65536?t[n++]=s>>12|224:(t[n++]=s>>18|240,t[n++]=s>>12&63|128),t[n++]=s>>6&63|128),t[n++]=63&s|128)}return t},Z=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J(e){return e&&e._delegate?e._delegate:e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.NODE_CLIENT=!0},67837:(e,t,n)=>{"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}n.d(t,{f:()=>u});var r=n(3729);n(81202);let s=(0,r.forwardRef)((e,t)=>{let{children:n,...s}=e,a=r.Children.toArray(n),l=a.find(h);if(l){let e=l.props.children,n=a.map(t=>t!==l?t:r.Children.count(e)>1?r.Children.only(null):(0,r.isValidElement)(e)?e.props.children:null);return(0,r.createElement)(o,i({},s,{ref:t}),(0,r.isValidElement)(e)?(0,r.cloneElement)(e,void 0,n):null)}return(0,r.createElement)(o,i({},s,{ref:t}),n)});s.displayName="Slot";let o=(0,r.forwardRef)((e,t)=>{let{children:n,...i}=e;return(0,r.isValidElement)(n)?(0,r.cloneElement)(n,{...function(e,t){let n={...t};for(let i in t){let r=e[i],s=t[i];/^on[A-Z]/.test(i)?r&&s?n[i]=(...e)=>{s(...e),r(...e)}:r&&(n[i]=r):"style"===i?n[i]={...r,...s}:"className"===i&&(n[i]=[r,s].filter(Boolean).join(" "))}return{...e,...n}}(i,n.props),ref:t?function(...e){return t=>e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}(t,n.ref):n.ref}):r.Children.count(n)>1?r.Children.only(null):null});o.displayName="SlotClone";let a=({children:e})=>(0,r.createElement)(r.Fragment,null,e);function h(e){return(0,r.isValidElement)(e)&&e.type===a}let l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let n=(0,r.forwardRef)((e,n)=>{let{asChild:o,...a}=e,h=o?s:t;return(0,r.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,r.createElement)(h,i({},a,{ref:n}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{}),u=(0,r.forwardRef)((e,t)=>(0,r.createElement)(l.label,i({},e,{ref:t,onMouseDown:t=>{var n;null===(n=e.onMouseDown)||void 0===n||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault()}})))},68474:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i.Z});var i=n(69429);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */i.Z.registerVersion("firebase","10.9.0","app-compat")},32874:(e,t,n)=>{"use strict";let i,r,s,o,a,h,l,u,c,d;var p,_=n(69429),f=n(47059),g=n(81453),m=n(36348),y=n(71954),v=n(95285);let b=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,C="websocket",E="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,m.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S=function(e){return new w},T=S("localStorage"),I=S("sessionStorage"),k=new y.Yd("@firebase/database"),x=function(){let e=1;return function(){return e++}}(),N=function(e){let t=(0,m.dS)(e),n=new m.gQ;n.update(t);let i=n.digest();return m.US.encodeByteArray(i)},P=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=P.apply(null,i):"object"==typeof i?t+=(0,m.Wl)(i):t+=i,t+=" "}return t},O=null,R=!0,D=function(e,t){(0,m.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(k.logLevel=y.in.VERBOSE,O=k.log.bind(k),t&&I.set("logging_enabled",!0)):"function"==typeof e?O=e:(O=null,I.remove("logging_enabled"))},A=function(...e){if(!0===R&&(R=!1,null===O&&!0===I.get("logging_enabled")&&D(!0)),O){let t=P.apply(null,e);O(t)}},L=function(e){return function(...t){A(e,...t)}},M=function(...e){let t="FIREBASE INTERNAL ERROR: "+P(...e);k.error(t)},F=function(...e){let t=`FIREBASE FATAL ERROR: ${P(...e)}`;throw k.error(t),Error(t)},q=function(...e){let t="FIREBASE WARNING: "+P(...e);k.warn(t)},B=function(){},U=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},H=function(e){if((0,m.Yr)()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},W="[MIN_NAME]",j="[MAX_NAME]",V=function(e,t){if(e===t)return 0;if(e===W||t===j)return -1;if(t===W||e===j)return 1;{let n=J(e),i=J(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},z=function(e,t){return e===t?0:e<t?-1:1},K=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+(0,m.Wl)(t))},Y=function(e){if("object"!=typeof e||null===e)return(0,m.Wl)(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=(0,m.Wl)(t[i])+":"+Y(e[t[i]]);return n+"}"},$=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function Q(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let G=function(e){let t,n,i,r,s;(0,m.hu)(!U(e),"Invalid JSON number"),0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-4503599627370496)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();let a=o.join(""),h="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()},Z=RegExp("^-?(0*)\\d{1,10}$"),J=function(e){if(Z.test(e)){let t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},X=function(e){try{e()}catch(e){setTimeout(()=>{throw q("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},ee=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=T.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&T.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function en(e,t,n){let i;if((0,m.hu)("string"==typeof t,"typeof type must == string"),(0,m.hu)("object"==typeof n,"typeof params must == object"),t===C)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===E)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return Q(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,m.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,m.p$)(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let er={},es={};function eo(e){let t=e.toString();return er[t]||(er[t]=new ei),er[t]}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ea="",eh=null;"undefined"!=typeof MozWebSocket?eh=MozWebSocket:"undefined"!=typeof WebSocket&&(eh=WebSocket);class el{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=L(this.connId),this.stats_=eo(t),this.connURL=el.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!(0,m.Yr)()&&"undefined"!=typeof location&&location.hostname&&b.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),en(e,C,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,T.set("previous_websocket_failure",!0);try{let e;if((0,m.Yr)()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${ea}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=process.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new eh(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){el.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==eh&&!el.forceDisallow_}static previouslyFailed(){return T.isInMemoryStorage||!0===T.get("previous_websocket_failure")}markConnectionHealthy(){T.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=(0,m.cI)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,m.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=(0,m.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=$(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}el.responsesRequiredToBeHealthy=2,el.healthyTimeout=3e4;let eu="@firebase/database",ec="1.0.3";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){q(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(A("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',q(e)}}class e_{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}e_.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&X(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eg="start";class em{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=L(e),this.stats_=eo(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),en(t,E,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ef(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),H(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ey((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder){if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===eg)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)}},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[eg]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&b.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){em.forceAllow_=!0}static forceDisallow(){em.forceDisallow_=!0}static isAvailable(){return!(0,m.Yr)()&&(!!em.forceAllow_||!em.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=(0,m.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=$((0,m.h$)(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,m.Yr)())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=(0,m.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ey{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,m.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=x(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ey.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');let i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){A("frame writing exception"),e.stack&&A(e.stack),A(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||A("No IE domain setting required")}catch(n){let t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){(0,m.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{A("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[em,el]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let t=el&&el.isAvailable(),n=t&&!el.previouslyFailed();if(e.webSocketOnly&&(t||q("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[el];else{let e=this.transports_=[];for(let t of ev.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ev.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ev.globalTransportInitialized_=!1;class eb{constructor(e,t,n,i,r,s,o,a,h,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=L("c:"+this.id+":"),this.transportManager_=new ev(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ee(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=K("t",e),n=K("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=K("t",e),n=K("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=K("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?M("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):M("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&q("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),ee(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ee(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(T.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,m.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context)){i.splice(e,1);return}}validateEventType_(e){(0,m.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew extends eE{constructor(){super(["online"]),this.online_=!0}static getInstance(){return new ew}getInitialEvent(e){return(0,m.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class eS{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function eT(){return new eS("")}function eI(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ek(e){return e.pieces_.length-e.pieceNum_}function ex(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new eS(e.pieces_,t)}function eN(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function eP(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function eO(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new eS(t,0)}function eR(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof eS)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new eS(n,0)}function eD(e){return e.pieceNum_>=e.pieces_.length}function eA(e,t){let n=eI(e),i=eI(t);if(null===n)return t;if(n===i)return eA(ex(e),ex(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function eL(e,t){let n=eP(e,0),i=eP(t,0);for(let e=0;e<n.length&&e<i.length;e++){let t=V(n[e],i[e]);if(0!==t)return t}return n.length===i.length?0:n.length<i.length?-1:1}function eM(e,t){if(ek(e)!==ek(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function eF(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(ek(e)>ek(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class eq{constructor(e,t){this.errorPrefix_=t,this.parts_=eP(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,m.ug)(this.parts_[e]);eB(this)}}function eB(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+eU(e))}function eU(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eH extends eE{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new eH}getInitialEvent(e){return(0,m.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}class eW extends eC{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=eW.nextPersistentConnectionId_++,this.log_=L("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!(0,m.Yr)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");eH.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ew.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_((0,m.Wl)(r)),(0,m.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new m.BH,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),(0,m.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,m.hu)(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;eW.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,m.r3)(e,"w")){let n=(0,m.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();q(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,m.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=(0,m.w9)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),(0,m.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,m.Wl)(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):M("Unrecognized action received from server: "+(0,m.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,m.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+eW.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){(0,m.hu)(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,l]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);s?A("getToken() completed but was canceled"):(A("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new eb(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{q(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&q(e),a())}}}interrupt(e){A("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){A("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,m.xb)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Y(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n;let i=new eS(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){A("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){A("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";(0,m.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+ea.replace(/\./g,"-")]=1,(0,m.uI)()?e["framework.cordova"]=1:(0,m.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=ew.getInstance().currentlyOnline();return(0,m.xb)(this.interruptReasons_)&&e}}eW.nextPersistentConnectionId_=0,eW.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ej(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eV{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new ej(W,e),i=new ej(W,t);return 0!==this.compare(n,i)}minPost(){return ej.MIN}}class ez extends eV{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return V(e.name,t.name)}isDefinedOn(e){throw(0,m.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ej.MIN}maxPost(){return new ej(j,i)}makePost(e,t){return(0,m.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new ej(e,i)}toString(){return".key"}}let eK=new ez;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eY{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class e${constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:e$.RED,this.left=null!=i?i:eG.EMPTY_NODE,this.right=null!=r?r:eG.EMPTY_NODE}copy(e,t,n,i,r){return new e$(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return eG.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return eG.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,e$.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,e$.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")}}e$.RED=!0,e$.BLACK=!1;class eQ{copy(e,t,n,i,r){return this}insert(e,t,n){return new e$(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class eG{constructor(e,t=eG.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new eG(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,e$.BLACK,null,null))}remove(e){return new eG(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,e$.BLACK,null,null))}get(e){let t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty()){if(i)return i.key;return null}for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new eY(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new eY(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new eY(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new eY(this.root_,null,this.comparator_,!0,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eZ(e,t){return V(e.name,t.name)}function eJ(e,t){return V(e,t)}eG.EMPTY_NODE=new eQ;let eX=function(e){return"number"==typeof e?"number:"+G(e):"string:"+e},e0=function(e){if(e.isLeafNode()){let t=e.val();(0,m.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,m.r3)(t,".sv"),"Priority must be a string or number.")}else(0,m.hu)(e===r||e.isEmpty(),"priority of unexpected type.");(0,m.hu)(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class e1{constructor(e,t=e1.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,m.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),e0(this.priorityNode_)}static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new e1(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:e1.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return eD(e)?this:".priority"===eI(e)?this.priorityNode_:e1.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:e1.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=eI(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,m.hu)(".priority"!==n||1===ek(e),".priority must be the last token in a path"),this.updateImmediateChild(n,e1.__childrenNodeConstructor.EMPTY_NODE.updateChild(ex(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+eX(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=G(this.value_):e+=this.value_,this.lazyHash_=N(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===e1.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof e1.__childrenNodeConstructor?-1:((0,m.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=e1.VALUE_TYPE_ORDER.indexOf(t),r=e1.VALUE_TYPE_ORDER.indexOf(n);return((0,m.hu)(i>=0,"Unknown leaf type: "+t),(0,m.hu)(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}e1.VALUE_TYPE_ORDER=["object","boolean","number","string"];class e2 extends eV{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?V(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ej.MIN}maxPost(){return new ej(j,new e1("[PRIORITY-POST]",a))}makePost(e,t){return new ej(t,new e1("[PRIORITY-POST]",o(e)))}toString(){return".priority"}}let e3=new e2,e4=Math.log(2);class e5{constructor(e){this.count=parseInt(Math.log(e+1)/e4,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let e9=function(e,t,n,i){e.sort(t);let r=function(t,i){let s;let o=i-t;if(0===o)return null;if(1===o)return s=e[t],new e$(n?n(s):s,s.node,e$.BLACK,null,null);{let a=parseInt(o/2,10)+t,h=r(t,a),l=r(a+1,i);return s=e[a],new e$(n?n(s):s,s.node,e$.BLACK,h,l)}};return new eG(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let l=r(s+1,a),u=e[s];h(new e$(n?n(u):u,u.node,i,null,l))},h=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,e$.BLACK):(a(i,e$.BLACK),a(i,e$.RED))}return s}(new e5(e.length)))},e8={};class e6{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,m.hu)(e8&&e3,"ChildrenNode.ts has not been loaded"),h=h||new e6({".priority":e8},{".priority":e3})}get(e){let t=(0,m.DV)(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof eG?t:null}hasIndex(e){return(0,m.r3)(this.indexSet_,e.toString())}addIndex(e,t){let n;(0,m.hu)(e!==eK,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(ej.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?e9(i,e.getCompare()):e8;let a=e.toString(),h=Object.assign({},this.indexSet_);h[a]=e;let l=Object.assign({},this.indexes_);return l[a]=n,new e6(l,h)}addToIndexes(e,t){return new e6((0,m.UI)(this.indexes_,(n,i)=>{let r=(0,m.DV)(this.indexSet_,i);if((0,m.hu)(r,"Missing index implementation for "+i),n===e8){if(!r.isDefinedOn(e.node))return e8;{let n=[],i=t.getIterator(ej.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),e9(n,r.getCompare())}}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new ej(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new e6((0,m.UI)(this.indexes_,n=>{if(n===e8)return n;{let i=t.get(e.name);return i?n.remove(new ej(e.name,i)):n}}),this.indexSet_)}}class e7{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&e0(this.priorityNode_),this.children_.isEmpty()&&(0,m.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return l||(l=new e7(new eG(eJ),null,e6.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||l}updatePriority(e){return this.children_.isEmpty()?this:new e7(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?l:t}}getChild(e){let t=eI(e);return null===t?this:this.getImmediateChild(t).getChild(ex(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,m.hu)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i;let r=new ej(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?l:this.priorityNode_;return new e7(n,s,i)}}updateChild(e,t){let n=eI(e);if(null===n)return t;{(0,m.hu)(".priority"!==eI(e)||1===ek(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(ex(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(e3,(s,o)=>{t[s]=o.val(e),n++,r&&e7.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+eX(this.getPriority().val())+":"),this.forEachChild(e3,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":N(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new ej(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new ej(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new ej(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,ej.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,ej.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===tt?-1:0}withIndex(e){if(e===eK||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new e7(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===eK||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority())||this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(e3),n=e.getIterator(e3),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===eK?null:this.indexMap_.get(e.toString())}}e7.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class te extends e7{constructor(){super(new eG(eJ),e7.EMPTY_NODE,e6.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return e7.EMPTY_NODE}isEmpty(){return!1}}let tt=new te;function tn(e,t=null){if(null===e)return e7.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,m.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new e1(e,tn(t));if(e instanceof Array){let n=e7.EMPTY_NODE;return Q(e,(t,i)=>{if((0,m.r3)(e,t)&&"."!==t.substring(0,1)){let e=tn(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(tn(t))}{let n=[],i=!1;if(Q(e,(e,t)=>{if("."!==e.substring(0,1)){let r=tn(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new ej(e,r)))}}),0===n.length)return e7.EMPTY_NODE;let r=e9(n,eZ,e=>e.name,eJ);if(!i)return new e7(r,tn(t),e6.Default);{let e=e9(n,e3.getCompare());return new e7(r,tn(t),new e6({".priority":e},{".priority":e3}))}}}Object.defineProperties(ej,{MIN:{value:new ej(W,e7.EMPTY_NODE)},MAX:{value:new ej(j,tt)}}),ez.__EMPTY_NODE=e7.EMPTY_NODE,e1.__childrenNodeConstructor=e7,r=tt,a=tt,o=tn;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti extends eV{constructor(e){super(),this.indexPath_=e,(0,m.hu)(!eD(e)&&".priority"!==eI(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?V(e.name,t.name):r}makePost(e,t){let n=tn(e);return new ej(t,e7.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new ej(j,e7.EMPTY_NODE.updateChild(this.indexPath_,tt))}toString(){return eP(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr extends eV{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?V(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ej.MIN}maxPost(){return ej.MAX}makePost(e,t){return new ej(t,tn(e))}toString(){return".value"}}let ts=new tr;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(e){return{type:"value",snapshotNode:e}}function ta(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function th(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function tl(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){(0,m.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(th(t,o)):(0,m.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(ta(t,n)):s.trackChildChange(tl(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null==n||(e.isLeafNode()||e.forEachChild(e3,(e,i)=>{t.hasChild(e)||n.trackChildChange(th(e,i))}),t.isLeafNode()||t.forEachChild(e3,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(tl(t,i,r))}else n.trackChildChange(ta(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?e7.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e){this.indexedFilter_=new tu(e.getIndex()),this.index_=e.getIndex(),this.startPost_=tc.getStartPost_(e),this.endPost_=tc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new ej(t,n))||(n=e7.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=e7.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(e7.EMPTY_NODE);let r=this;return t.forEachChild(e3,(e,t)=>{r.matches(new ej(e,t))||(i=i.updateImmediateChild(e,e7.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new tc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new ej(t,n))||(n=e7.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=e7.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=e7.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t)){if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(e7.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,e7.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();(0,m.hu)(e.numChildren()===this.limit_,"");let o=new ej(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),h=this.rangedFilter_.matches(o);if(e.hasChild(t)){let l=e.getImmediateChild(t),u=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(h&&!n.isEmpty()&&c>=0)return null!=r&&r.trackChildChange(tl(t,n,l)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(th(t,l));let n=e.updateImmediateChild(t,e7.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(ta(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:h&&s(a,o)>=0?(null!=r&&(r.trackChildChange(th(a.name,a.node)),r.trackChildChange(ta(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,e7.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=e3}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,m.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,m.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:W}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,m.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,m.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:j}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,m.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===e3}copy(){let e=new tp;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function t_(e,t,n){let i=e.copy();return i.startSet_=!0,void 0===t&&(t=null),i.indexStartValue_=t,null!=n?(i.startNameSet_=!0,i.indexStartName_=n):(i.startNameSet_=!1,i.indexStartName_=""),i}function tf(e,t,n){let i=e.copy();return i.endSet_=!0,void 0===t&&(t=null),i.indexEndValue_=t,void 0!==n?(i.endNameSet_=!0,i.indexEndName_=n):(i.endNameSet_=!1,i.indexEndName_=""),i}function tg(e,t){let n=e.copy();return n.index_=t,n}function tm(e){let t;let n={};if(e.isDefault())return n;if(e.index_===e3?t="$priority":e.index_===ts?t="$value":e.index_===eK?t="$key":((0,m.hu)(e.index_ instanceof ti,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,m.Wl)(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=(0,m.Wl)(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+(0,m.Wl)(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=(0,m.Wl)(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+(0,m.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function ty(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==e3&&(t.i=e.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv extends eC{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=L("p:rest:"),this.listens_={}}reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,m.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=tv.getListenId_(e,n),o={};this.listens_[s]=o;let a=tm(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),(0,m.DV)(this.listens_,s)===o&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=tv.getListenId_(e,t);delete this.listens_[n]}get(e){let t=tm(e._queryParams),n=e._path.toString(),i=new m.BH;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,m.xO)(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=(0,m.cI)(o.responseText)}catch(e){q("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&q("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(){this.rootNode_=e7.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(){return{value:null,children:new Map}}function tE(e,t,n){if(eD(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{let i=eI(t);e.children.has(i)||e.children.set(i,tC()),tE(e.children.get(i),t=ex(t),n)}}function tw(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,i)=>{tw(i,new eS(t.toString()+"/"+e),n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Q(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class tT{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new tS(e),ee(this.reportStats_.bind(this),Math.floor(1e4+2e4*Math.random()))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;Q(e,(e,i)=>{i>0&&(0,m.r3)(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),ee(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function tI(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tk(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function tx(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(p||(p={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=p.ACK_USER_WRITE,this.source=tI()}operationForChild(e){if(!eD(this.path))return(0,m.hu)(eI(this.path)===e,"operationForChild called for unrelated child."),new tN(ex(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,m.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new eS(e));return new tN(eT(),t,this.revert)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e,t){this.source=e,this.path=t,this.type=p.LISTEN_COMPLETE}operationForChild(e){return eD(this.path)?new tP(this.source,eT()):new tP(this.source,ex(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=p.OVERWRITE}operationForChild(e){return eD(this.path)?new tO(this.source,eT(),this.snap.getImmediateChild(e)):new tO(this.source,ex(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=p.MERGE}operationForChild(e){if(!eD(this.path))return(0,m.hu)(eI(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new tR(this.source,ex(this.path),this.children);{let t=this.children.subtree(new eS(e));return t.isEmpty()?null:t.value?new tO(this.source,eT(),t.value):new tR(this.source,eT(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(eD(e))return this.isFullyInitialized()&&!this.filtered_;let t=eI(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tA{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function tL(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw(0,m.g5)("Should only compare child_ events.");let i=new ej(t.childName,t.snapshotNode),r=new ej(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{let i=("value"===n.type||"child_removed"===n.type||(n.prevName=s.getPredecessorChildName(n.childName,n.snapshotNode,e.index_)),n);r.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tM(e,t){return{eventCache:e,serverCache:t}}function tF(e,t,n,i){return tM(new tD(t,n,i),e.serverCache)}function tq(e,t,n,i){return tM(e.eventCache,new tD(t,n,i))}function tB(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function tU(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let tH=()=>(u||(u=new eG(z)),u);class tW{constructor(e,t=tH()){this.value=e,this.children=t}static fromObject(e){let t=new tW(null);return Q(e,(e,n)=>{t=t.set(new eS(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:eT(),value:this.value};if(eD(e))return null;{let n=eI(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(ex(e),t);return null!=r?{path:eR(new eS(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(eD(e))return this;{let t=eI(e),n=this.children.get(t);return null!==n?n.subtree(ex(e)):new tW(null)}}set(e,t){if(eD(e))return new tW(t,this.children);{let n=eI(e),i=(this.children.get(n)||new tW(null)).set(ex(e),t),r=this.children.insert(n,i);return new tW(this.value,r)}}remove(e){if(eD(e))return this.children.isEmpty()?new tW(null):new tW(null,this.children);{let t=eI(e),n=this.children.get(t);if(!n)return this;{let i;let r=n.remove(ex(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new tW(null):new tW(this.value,i)}}}get(e){if(eD(e))return this.value;{let t=eI(e),n=this.children.get(t);return n?n.get(ex(e)):null}}setTree(e,t){if(eD(e))return t;{let n;let i=eI(e),r=(this.children.get(i)||new tW(null)).setTree(ex(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new tW(this.value,n)}}fold(e){return this.fold_(eT(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(eR(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,eT(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;if(eD(e))return null;{let i=eI(e),r=this.children.get(i);return r?r.findOnPath_(ex(e),eR(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,eT(),t)}foreachOnPath_(e,t,n){if(eD(e))return this;{this.value&&n(t,this.value);let i=eI(e),r=this.children.get(i);return r?r.foreachOnPath_(ex(e),eR(t,i),n):new tW(null)}}foreach(e){this.foreach_(eT(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(eR(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e){this.writeTree_=e}static empty(){return new tj(new tW(null))}}function tV(e,t,n){if(eD(t))return new tj(new tW(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=eA(r,t);return s=s.updateChild(o,n),new tj(e.writeTree_.set(r,s))}{let i=new tW(n);return new tj(e.writeTree_.setTree(t,i))}}}function tz(e,t,n){let i=e;return Q(n,(e,n)=>{i=tV(i,eR(t,e),n)}),i}function tK(e,t){return eD(t)?tj.empty():new tj(e.writeTree_.setTree(t,new tW(null)))}function tY(e,t){return null!=t$(e,t)}function t$(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(eA(n.path,t)):null}function tQ(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(e3,(e,n)=>{t.push(new ej(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new ej(e,n.value))}),t}function tG(e,t){if(eD(t))return e;{let n=t$(e,t);return new tj(null!=n?new tW(n):e.writeTree_.subtree(t))}}function tZ(e){return e.writeTree_.isEmpty()}function tJ(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?((0,m.hu)(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(eR(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(eR(t,".priority"),r)),i}}(eT(),e.writeTree_,t)}function tX(e){return e.visible}function t0(e,t,n){let i=tj.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e;let t=s.path;if(s.snap)eF(n,t)?i=tV(i,e=eA(n,t),s.snap):eF(t,n)&&(e=eA(t,n),i=tV(i,eT(),s.snap.getChild(e)));else if(s.children){if(eF(n,t))i=tz(i,e=eA(n,t),s.children);else if(eF(t,n)){if(eD(e=eA(t,n)))i=tz(i,eT(),s.children);else{let t=(0,m.DV)(s.children,eI(e));if(t){let n=t.getChild(ex(e));i=tV(i,eT(),n)}}}}else throw(0,m.g5)("WriteRecord should have .snap or .children")}}return i}function t1(e,t,n,i,r){if(i||r){let s=tG(e.visibleWrites,t);return!r&&tZ(s)?n:r||null!=n||tY(s,eT())?tJ(t0(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(eF(e.path,t)||eF(t,e.path))},t),n||e7.EMPTY_NODE):null}{let i=t$(e.visibleWrites,t);if(null!=i)return i;{let i=tG(e.visibleWrites,t);return tZ(i)?n:null!=n||tY(i,eT())?tJ(i,n||e7.EMPTY_NODE):null}}}function t2(e,t,n,i){return t1(e.writeTree,e.treePath,t,n,i)}function t3(e,t){return function(e,t,n){let i=e7.EMPTY_NODE,r=t$(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(e3,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return tQ(tG(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=tG(e.visibleWrites,t);return n.forEachChild(e3,(e,t)=>{let n=tJ(tG(r,new eS(e)),t);i=i.updateImmediateChild(e,n)}),tQ(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function t4(e,t,n,i){return function(e,t,n,i,r){(0,m.hu)(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=eR(t,n);if(tY(e.visibleWrites,s))return null;{let t=tG(e.visibleWrites,s);return tZ(t)?r.getChild(n):tJ(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function t5(e,t){var n,i;return n=e.writeTree,i=eR(e.treePath,t),t$(n.visibleWrites,i)}function t9(e,t,n){return function(e,t,n,i){let r=eR(t,n),s=t$(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?tJ(tG(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function t8(e,t){return t6(eR(e.treePath,t),e.writeTree)}function t6(e,t){return{treePath:e,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t7{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;(0,m.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,m.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,tl(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,th(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,ta(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,tl(n,e.snapshotNode,i.oldSnap));else throw(0,m.g5)("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}let nt=new ne;class nn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new tD(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return t9(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:tU(this.viewCache_),s=function(e,t,n,i,r,s,o){let a;let h=tG(e.visibleWrites,t),l=t$(h,eT());if(null!=l)a=l;else{if(null==n)return[];a=tJ(h,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}((i=this.writes_).writeTree,i.treePath,r,t,0,n,e);return 0===s.length?null:s[0]}}function ni(e,t,n,i,r,s){let o=t.eventCache;if(null!=t5(i,n))return t;{let a,h;if(eD(n)){if((0,m.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=tU(t),r=t3(i,n instanceof e7?n:e7.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=t2(i,tU(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}}else{let l=eI(n);if(".priority"===l){(0,m.hu)(1===ek(n),"Can't have a priority with additional path components");let r=o.getNode(),s=t4(i,n,r,h=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let u;let c=ex(n);if(o.isCompleteForChild(l)){h=t.serverCache.getNode();let e=t4(i,n,o.getNode(),h);u=null!=e?o.getNode().getImmediateChild(l).updateChild(c,e):o.getNode().getImmediateChild(l)}else u=t9(i,l,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),l,u,c,r,s):o.getNode()}}return tF(t,a,o.isFullyInitialized()||eD(n),e.filter.filtersNodes())}}function nr(e,t,n,i,r,s,o,a){let h;let l=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(eD(n))h=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){let e=l.getNode().updateChild(n,i);h=u.updateFullNode(l.getNode(),e,null)}else{let e=eI(n);if(!l.isCompleteForPath(n)&&ek(n)>1)return t;let r=ex(n),s=l.getNode().getImmediateChild(e).updateChild(r,i);h=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,r,nt,null)}let c=tq(t,h,l.isFullyInitialized()||eD(n),u.filtersNodes()),d=new nn(r,c,s);return ni(e,c,n,r,d,a)}function ns(e,t,n,i,r,s,o){let a,h;let l=t.eventCache,u=new nn(r,t,s);if(eD(n))h=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=tF(t,h,!0,e.filter.filtersNodes());else{let r=eI(n);if(".priority"===r)h=e.filter.updatePriority(t.eventCache.getNode(),i),a=tF(t,h,l.isFullyInitialized(),l.isFiltered());else{let s;let h=ex(n),c=l.getNode().getImmediateChild(r);if(eD(h))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===eN(h)&&e.getChild(eO(h)).isEmpty()?e:e.updateChild(h,i):e7.EMPTY_NODE}a=c.equals(s)?t:tF(t,e.filter.updateChild(l.getNode(),r,s,h,u,o),l.isFullyInitialized(),e.filter.filtersNodes())}}return a}function no(e,t){return e.eventCache.isCompleteForChild(t)}function na(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function nh(e,t,n,i,r,s,o,a){let h;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l=t;h=eD(n)?i:new tW(null).setTree(n,i);let u=t.serverCache.getNode();return h.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let h=na(e,t.serverCache.getNode().getImmediateChild(n),i);l=nr(e,l,new eS(n),h,r,s,o,a)}}),h.children.inorderTraversal((n,i)=>{let h=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!h){let h=na(e,t.serverCache.getNode().getImmediateChild(n),i);l=nr(e,l,new eS(n),h,r,s,o,a)}}),l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,i=new tu(n.getIndex()),r=function(e){return e.loadsAllData()?new tu(e.getIndex()):e.hasLimit()?new td(e):new tc(e)}(n);this.processor_={filter:r};let s=t.serverCache,o=t.eventCache,a=i.updateFullNode(e7.EMPTY_NODE,s.getNode(),null),h=r.updateFullNode(e7.EMPTY_NODE,o.getNode(),null),l=new tD(a,s.isFullyInitialized(),i.filtersNodes()),u=new tD(h,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=tM(u,l),this.eventGenerator_=new tA(this.query_)}get query(){return this.query_}}function nu(e){return 0===e.eventRegistrations_.length}function nc(e,t,n){let i=[];if(n){(0,m.hu)(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function nd(e,t,n,i){var r,s;t.type===p.MERGE&&null!==t.source.queryId&&((0,m.hu)(tU(e.viewCache_),"We should always have a full cache before handling merges"),(0,m.hu)(tB(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){let s,o;let a=new t7;if(n.type===p.OVERWRITE)n.source.fromUser?s=ns(e,t,n.path,n.snap,i,r,a):((0,m.hu)(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered()&&!eD(n.path),s=nr(e,t,n.path,n.snap,i,r,o,a));else if(n.type===p.MERGE){var h,l;let u;n.source.fromUser?(h=n.path,l=n.children,u=t,l.foreach((n,s)=>{let o=eR(h,n);no(t,eI(o))&&(u=ns(e,u,o,s,i,r,a))}),l.foreach((n,s)=>{let o=eR(h,n);no(t,eI(o))||(u=ns(e,u,o,s,i,r,a))}),s=u):((0,m.hu)(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered(),s=nh(e,t,n.path,n.children,i,r,o,a))}else if(n.type===p.ACK_USER_WRITE)s=n.revert?function(e,t,n,i,r,s){let o;if(null!=t5(i,n))return t;{let a;let h=new nn(i,t,r),l=t.eventCache.getNode();if(eD(n)||".priority"===eI(n)){let n;if(t.serverCache.isFullyInitialized())n=t2(i,tU(t));else{let e=t.serverCache.getNode();(0,m.hu)(e instanceof e7,"serverChildren would be complete if leaf node"),n=t3(i,e)}a=e.filter.updateFullNode(l,n,s)}else{let r=eI(n),u=t9(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=l.getImmediateChild(r)),(a=null!=u?e.filter.updateChild(l,r,u,ex(n),h,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(l,r,e7.EMPTY_NODE,ex(n),h,s):l).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=t2(i,tU(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=t5(i,eT()),tF(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,a):function(e,t,n,i,r,s,o){if(null!=t5(r,n))return t;let a=t.serverCache.isFiltered(),h=t.serverCache;if(null!=i.value){if(eD(n)&&h.isFullyInitialized()||h.isCompleteForPath(n))return nr(e,t,n,h.getNode().getChild(n),r,s,a,o);if(!eD(n))return t;{let i=new tW(null);return h.getNode().forEachChild(eK,(e,t)=>{i=i.set(new eS(e),t)}),nh(e,t,n,i,r,s,a,o)}}{let l=new tW(null);return i.foreach((e,t)=>{let i=eR(n,e);h.isCompleteForPath(i)&&(l=l.set(e,h.getNode().getChild(i)))}),nh(e,t,n,l,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,a);else if(n.type===p.LISTEN_COMPLETE)s=function(e,t,n,i,r){let s=t.serverCache;return ni(e,tq(t,s.getNode(),s.isFullyInitialized()||eD(n),s.isFiltered()),n,i,nt,r)}(e,t,n.path,i,a);else throw(0,m.g5)("Unknown operation type: "+n.type);let u=a.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=tB(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(to(tB(t)))}}(t,s,u),{viewCache:s,changes:u}}(e.processor_,o,t,n,i);return r=e.processor_,s=a.viewCache,(0,m.hu)(s.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),(0,m.hu)(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),(0,m.hu)(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,np(e,a.changes,a.viewCache.eventCache.getNode(),null)}function np(e,t,n,i){let r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){let r=[],s=[];return t.forEach(t=>{if("child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)){var n;s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}}),tL(e,r,"child_removed",t,i,n),tL(e,r,"child_added",t,i,n),tL(e,r,"child_moved",s,i,n),tL(e,r,"child_changed",t,i,n),tL(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}class n_{constructor(){this.views=new Map}}function nf(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return(0,m.hu)(null!=s,"SyncTree gave us an op for an invalid query."),nd(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(nd(s,t,n,i));return r}}function ng(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=t2(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof e7?t3(n,i):e7.EMPTY_NODE,s=!1),new nl(t,tM(new tD(e,s,!1),new tD(i,r,!1)))}return o}function nm(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function ny(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=tU(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!eD(t)&&!n.getImmediateChild(eI(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function nv(e,t){if(t._queryParams.loadsAllData())return nC(e);{let n=t._queryIdentifier;return e.views.get(n)}}function nb(e){return null!=nC(e)}function nC(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let nE=1;class nw{constructor(e){this.listenProvider_=e,this.syncPointTree_=new tW(null),this.pendingWriteTree_={visibleWrites:tj.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function nS(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,(0,m.hu)(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=tV(s.visibleWrites,t,n)),s.lastWriteId=i,r)?nO(e,new tO(tI(),t,n)):[]}function nT(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){let n=e.allWrites.findIndex(e=>e.writeId===t);(0,m.hu)(n>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,s=!1,o=e.allWrites.length-1;for(;r&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=n&&function(e,t){if(e.snap)return eF(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&eF(eR(e.path,n),t))return!0;return!1}(t,i.path)?r=!1:eF(i.path,t.path)&&(s=!0)),o--}return!!r&&(s?(e.visibleWrites=t0(e.allWrites,tX,eT()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?e.visibleWrites=tK(e.visibleWrites,i.path):Q(i.children,t=>{e.visibleWrites=tK(e.visibleWrites,eR(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new tW(null);return null!=i.snap?t=t.set(eT(),!0):Q(i.children,e=>{t=t.set(new eS(e),!0)}),nO(e,new tN(i.path,t,n))}}function nI(e,t,n){return nO(e,new tO(tk(),t,n))}function nk(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=nv(o,t))){let h=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=nb(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(nc(r,n,i)),nu(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(nc(t,n,i)),nu(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!nb(e)&&s.push(new((0,m.hu)(c,"Reference.ts has not been loaded"),c)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let l=h.removed;if(a=h.events,!r){let n=-1!==l.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>nb(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&nb(t))return[nC(t)];{let e=[];return t&&(e=nm(t)),Q(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=nR(e,i);e.listenProvider_.startListening(nq(r),nD(e,r),s.hashFn,s.onComplete)}}}r||!(l.length>0)||i||(n?e.listenProvider_.stopListening(nq(t),null):l.forEach(t=>{let n=e.queryToTagMap.get(nA(t));e.listenProvider_.stopListening(nq(t),n)}))}(function(e,t){for(let n=0;n<t.length;++n){let i=t[n];if(!i._queryParams.loadsAllData()){let t=nA(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}})(e,l)}return a}function nx(e,t,n,i){let r=nL(e,i);if(null==r)return[];{let i=nM(r),s=i.path,o=i.queryId,a=eA(s,t);return nF(e,s,new tO(tx(o),a,n))}}function nN(e,t,n,i=!1){let r;let s=t._path,o=null,a=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{let n=eA(e,s);o=o||ny(t,n),a=a||nb(t)});let h=e.syncPointTree_.get(s);h?(a=a||nb(h),o=o||ny(h,eT())):(h=new n_,e.syncPointTree_=e.syncPointTree_.set(s,h)),null!=o?r=!0:(r=!1,o=e7.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild((e,t)=>{let n=ny(t,eT());n&&(o=o.updateImmediateChild(e,n))}));let l=null!=nv(h,t);if(!l&&!t._queryParams.loadsAllData()){let n=nA(t);(0,m.hu)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=nE++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let u=function(e,t,n,i,r,s){let o=ng(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){let n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(e3,(e,t)=>{i.push(ta(e,t))}),n.isFullyInitialized()&&i.push(to(n.getNode())),np(e,i,n.getNode(),t)}(o,n)}(h,t,n,t6(s,e.pendingWriteTree_),o,r);if(!l&&!a&&!i){let n=nv(h,t);u=u.concat(function(e,t,n){let i=t._path,r=nD(e,t),s=nR(e,n),o=e.listenProvider_.startListening(nq(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)(0,m.hu)(!nb(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!eD(e)&&t&&nb(t))return[nC(t).query];{let e=[];return t&&(e=e.concat(nm(t).map(e=>e.query))),Q(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(nq(i),nD(e,i))}}return o}(e,t,n))}return u}function nP(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=ny(n,eA(e,t));if(i)return i});return t1(i,t,r,n,!0)}function nO(e,t){var n;return function e(t,n,i,r){if(eD(t.path))return function e(t,n,i,r){let s=n.get(eT());null==i&&null!=s&&(i=ny(s,eT()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,h=t8(r,n),l=t.operationForChild(n);l&&(o=o.concat(e(l,s,a,h)))}),s&&(o=o.concat(nf(s,t,r,i))),o}(t,n,i,r);{let s=n.get(eT());null==i&&null!=s&&(i=ny(s,eT()));let o=[],a=eI(t.path),h=t.operationForChild(a),l=n.children.get(a);if(l&&h){let t=i?i.getImmediateChild(a):null,n=t8(r,a);o=o.concat(e(h,l,t,n))}return s&&(o=o.concat(nf(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,t6(eT(),n)))}function nR(e,t){let n=t.query,i=nD(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||e7.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t){var r;return i?function(e,t,n){let i=nL(e,n);if(!i)return[];{let n=nM(i),r=n.path,s=n.queryId,o=eA(r,t);return nF(e,r,new tP(tx(s),o))}}(e,n._path,i):(r=n._path,nO(e,new tP(tk(),r)))}{let i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");let i=Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return nk(e,n,null,i)}}}}function nD(e,t){let n=nA(t);return e.queryToTagMap.get(n)}function nA(e){return e._path.toString()+"$"+e._queryIdentifier}function nL(e,t){return e.tagToQueryMap.get(t)}function nM(e){let t=e.indexOf("$");return(0,m.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new eS(e.substr(0,t))}}function nF(e,t,n){let i=e.syncPointTree_.get(t);return(0,m.hu)(i,"Missing sync point for query tag that we're tracking"),nf(i,n,t6(t,e.pendingWriteTree_),null)}function nq(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,m.hu)(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB{constructor(e){this.node_=e}getImmediateChild(e){return new nB(this.node_.getImmediateChild(e))}node(){return this.node_}}class nU{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=eR(this.path_,e);return new nU(this.syncTree_,t)}node(){return nP(this.syncTree_,this.path_)}}let nH=function(e,t,n){return e&&"object"==typeof e?((0,m.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?nW(e[".sv"],t,n):"object"==typeof e[".sv"]?nj(e[".sv"],t):void(0,m.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},nW=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,m.hu)(!1,"Unexpected server value: "+e)},nj=function(e,t,n){e.hasOwnProperty("increment")||(0,m.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&(0,m.hu)(!1,"Unexpected increment value: "+i);let r=t.node();if((0,m.hu)(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},nV=function(e,t,n,i){return nK(t,new nU(n,e),i)},nz=function(e,t,n){return nK(e,new nB(t),n)};function nK(e,t,n){let i;let r=nH(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new e1(r))),e.forEachChild(e3,(e,r)=>{let s=nK(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=nH(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new e1(i,tn(r)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nY{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function n$(e,t){let n=t instanceof eS?t:new eS(t),i=e,r=eI(n);for(;null!==r;){let e=(0,m.DV)(i.node.children,r)||{children:{},childCount:0};i=new nY(r,i,e),r=eI(n=ex(n))}return i}function nQ(e){return e.node.value}function nG(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===nQ(i)&&!nZ(i),s=(0,m.r3)(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function nZ(e){return e.node.childCount>0}function nJ(e,t){Q(e.node.children,(n,i)=>{t(new nY(n,e,i))})}function nX(e){return new eS(null===e.parent?e.name:nX(e.parent)+"/"+e.name)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n0=/[\[\].#$\/\u0000-\u001F\u007F]/,n1=/[\[\].#$\u0000-\u001F\u007F]/,n2=function(e){return"string"==typeof e&&0!==e.length&&!n0.test(e)},n3=function(e){return"string"==typeof e&&0!==e.length&&!n1.test(e)},n4=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!U(e)||e&&"object"==typeof e&&(0,m.r3)(e,".sv")},n5=function(e,t,n,i){i&&void 0===t||n9((0,m.gK)(e,"value"),t,n)},n9=function(e,t,n){let i=n instanceof eS?new eq(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+eU(i));if("function"==typeof t)throw Error(e+"contains a function "+eU(i)+" with contents = "+t.toString());if(U(t))throw Error(e+"contains "+t.toString()+" "+eU(i));if("string"==typeof t&&t.length>3495253.3333333335&&(0,m.ug)(t)>10485760)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+eU(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(Q(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!n2(t)))throw Error(e+" contains an invalid key ("+t+") "+eU(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=(0,m.ug)(t),eB(i),n9(e,s,i),function(e){let t=e.parts_.pop();e.byteLength_-=(0,m.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)}),n&&r)throw Error(e+' contains ".value" child '+eU(i)+" in addition to actual children.")}},n8=function(e,t){let n,i;for(n=0;n<t.length;n++){let r=eP(i=t[n]);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!n2(r[t]))throw Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(eL);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&eF(r,i))throw Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},n6=function(e,t,n,i){if(i&&void 0===t)return;let r=(0,m.gK)(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(r+" must be an object containing the children to replace.");let s=[];Q(t,(e,t)=>{let i=new eS(e);if(n9(r,t,eR(n,i)),".priority"===eN(i)&&!n4(t))throw Error(r+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(i)}),n8(r,s)},n7=function(e,t,n){if(!n||void 0!==t){if(U(t))throw Error((0,m.gK)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!n4(t))throw Error((0,m.gK)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ie=function(e,t,n,i){if((!i||void 0!==n)&&!n2(n))throw Error((0,m.gK)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},it=function(e,t,n,i){if((!i||void 0!==n)&&!n3(n))throw Error((0,m.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ii=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),it(e,t,n,i)},ir=function(e,t){if(".info"===eI(t))throw Error(e+" failed = Can't modify data under /.info/")},is=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!n2(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!n3(n)))throw Error((0,m.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ia(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||eM(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function ih(e,t,n){ia(e,n),iu(e,e=>eM(e,t))}function il(e,t,n){ia(e,n),iu(e,e=>eF(e,t)||eF(t,e))}function iu(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();O&&A("event: "+n.toString()),X(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ic="repo_interrupt";class id{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new io,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=tC(),this.transactionQueueTree_=new nY,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ip(e){let t=e.infoData_.getNode(new eS(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function i_(e){var t;return(t=t={timestamp:ip(e)}).timestamp=t.timestamp||new Date().getTime(),t}function ig(e,t,n,i,r){e.dataUpdateCount++;let s=new eS(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r){if(i){let t=(0,m.UI)(n,e=>tn(e));o=function(e,t,n,i){let r=nL(e,i);if(!r)return[];{let i=nM(r),s=i.path,o=i.queryId,a=eA(s,t),h=tW.fromObject(n);return nF(e,s,new tR(tx(o),a,h))}}(e.serverSyncTree_,s,t,r)}else{let t=tn(n);o=nx(e.serverSyncTree_,s,t,r)}}else if(i){let t=(0,m.UI)(n,e=>tn(e));o=function(e,t,n){let i=tW.fromObject(n);return nO(e,new tR(tk(),t,i))}(e.serverSyncTree_,s,t)}else{let t=tn(n);o=nI(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=ix(e,s)),il(e.eventQueue_,a,o)}function im(e,t){iy(e,"connected",t),!1===t&&function(e){iS(e,"onDisconnectEvents");let t=i_(e),n=tC();tw(e.onDisconnect_,eT(),(i,r)=>{let s=nV(i,r,e.serverSyncTree_,t);tE(n,i,s)});let i=[];tw(n,eT(),(t,n)=>{i=i.concat(nI(e.serverSyncTree_,t,n));let r=iR(e,t);ix(e,r)}),e.onDisconnect_=tC(),il(e.eventQueue_,eT(),i)}(e)}function iy(e,t,n){let i=new eS("/.info/"+t),r=tn(n);e.infoData_.updateSnapshot(i,r);let s=nI(e.infoSyncTree_,i,r);il(e.eventQueue_,i,s)}function iv(e){return e.nextWriteId_++}function ib(e,t,n,i,r){iS(e,"set",{path:t.toString(),value:n,priority:i});let s=i_(e),o=tn(n,i),a=nz(o,nP(e.serverSyncTree_,t),s),h=iv(e),l=nS(e.serverSyncTree_,t,a,h,!0);ia(e.eventQueue_,l),e.server_.put(t.toString(),o.val(!0),(n,i)=>{let s="ok"===n;s||q("set at "+t+" failed: "+n);let o=nT(e.serverSyncTree_,h,!s);il(e.eventQueue_,t,o),iT(e,r,n,i)});let u=iR(e,t);ix(e,u),il(e.eventQueue_,u,[])}function iC(e,t,n,i){let r=tn(n);e.server_.onDisconnectPut(t.toString(),r.val(!0),(n,s)=>{"ok"===n&&tE(e.onDisconnect_,t,r),iT(e,i,n,s)})}function iE(e,t,n){let i;i=".info"===eI(t._path)?nk(e.infoSyncTree_,t,n):nk(e.serverSyncTree_,t,n),ih(e.eventQueue_,t._path,i)}function iw(e){e.persistentConnection_&&e.persistentConnection_.interrupt(ic)}function iS(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),A(n,...t)}function iT(e,t,n,i){t&&X(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),r=e;i&&(r+=": "+i);let s=Error(r);s.code=e,t(s)}})}function iI(e,t,n){return nP(e.serverSyncTree_,t,n)||e7.EMPTY_NODE}function ik(e,t=e.transactionQueueTree_){if(t||iO(e,t),nQ(t)){let n=iP(e,t);(0,m.hu)(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){let i=iI(e,t,n.map(e=>e.currentWriteId)),r=i,s=i.hash();for(let e=0;e<n.length;e++){let i=n[e];(0,m.hu)(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;let s=eA(t,i.path);r=r.updateChild(s,i.currentOutputSnapshotRaw)}let o=r.val(!0);e.server_.put(t.toString(),o,i=>{iS(e,"transaction put response",{path:t.toString(),status:i});let r=[];if("ok"===i){let i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(nT(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();iO(e,n$(e.transactionQueueTree_,t)),ik(e,e.transactionQueueTree_),il(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)X(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{q("transaction at "+t.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}ix(e,t)}},s)}(e,nX(t),n)}else nZ(t)&&nJ(t,t=>{ik(e,t)})}function ix(e,t){let n=iN(e,t),i=nX(n),r=iP(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],h=eA(n,a.path),l=!1,u;if((0,m.hu)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)l=!0,u=a.abortReason,r=r.concat(nT(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status){if(a.retryCount>=25)l=!0,u="maxretry",r=r.concat(nT(e.serverSyncTree_,a.currentWriteId,!0));else{let n=iI(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){n9("transaction failed: Data returned ",i,a.path);let t=tn(i);"object"==typeof i&&null!=i&&(0,m.r3)(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,h=nz(t,n,i_(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=iv(e),s.splice(s.indexOf(o),1),r=(r=r.concat(nS(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(nT(e.serverSyncTree_,o,!0))}else l=!0,u="nodata",r=r.concat(nT(e.serverSyncTree_,a.currentWriteId,!0))}}il(e.eventQueue_,n,r),r=[],l&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(u),!1,null))))}iO(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)X(i[e]);ik(e,e.transactionQueueTree_)}(e,r,i),i}function iN(e,t){let n;let i=e.transactionQueueTree_;for(n=eI(t);null!==n&&void 0===nQ(i);)i=n$(i,n),n=eI(t=ex(t));return i}function iP(e,t){let n=[];return function e(t,n,i){let r=nQ(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);nJ(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function iO(e,t){let n=nQ(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,nG(t,n.length>0?n:void 0)}nJ(t,t=>{iO(e,t)})}function iR(e,t){let n=nX(iN(e,t)),i=n$(e.transactionQueueTree_,t);return function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{iD(e,t)}),iD(e,i),function e(t,n,i,r){i&&!r&&n(t),nJ(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{iD(e,t)}),n}function iD(e,t){let n=nQ(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,m.hu)(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):((0,m.hu)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(nT(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?nG(t,void 0):n.length=s+1,il(e.eventQueue_,nX(t),r);for(let e=0;e<i.length;e++)X(i[e])}}let iA=function(e,t){let n=iL(e),i=n.namespace;"firebase.com"===n.domain&&F(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||F("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||B();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new et(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new eS(n.pathString)}},iL=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",h=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):q(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(l=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,h=parseInt(t.substring(l+1),10)):l=t.length;let p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:h,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},iM="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",iF=function(){let e=0,t=[];return function(n){let i;let r=n===e;e=n;let s=Array(8);for(i=7;i>=0;i--)s[i]=iM.charAt(n%64),n=Math.floor(n/64);(0,m.hu)(0===n,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)o+=iM.charAt(t[i]);return(0,m.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iq{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,m.Wl)(this.snapshot.exportVal())}}class iB{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,m.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iH{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new m.BH;return function(e,t,n){e.server_.onDisconnectCancel(t.toString(),(i,r)=>{"ok"===i&&function e(t,n){if(eD(n))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;{let i=t.value;return t.value=null,i.forEachChild(e3,(e,n)=>{tE(t,new eS(e),n)}),e(t,n)}}if(!(t.children.size>0))return!0;{let i=eI(n);return n=ex(n),t.children.has(i)&&e(t.children.get(i),n)&&t.children.delete(i),0===t.children.size}}(e.onDisconnect_,t),iT(e,n,i,r)})}(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ir("OnDisconnect.remove",this._path);let e=new m.BH;return iC(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ir("OnDisconnect.set",this._path),n5("OnDisconnect.set",e,this._path,!1);let t=new m.BH;return iC(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){ir("OnDisconnect.setWithPriority",this._path),n5("OnDisconnect.setWithPriority",e,this._path,!1),n7("OnDisconnect.setWithPriority",t,!1);let n=new m.BH;return function(e,t,n,i,r){let s=tn(n,i);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,i)=>{"ok"===n&&tE(e.onDisconnect_,t,s),iT(e,r,n,i)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){ir("OnDisconnect.update",this._path),n6("OnDisconnect.update",e,this._path,!1);let t=new m.BH;return function(e,t,n,i){if((0,m.xb)(n)){A("onDisconnect().update() called with empty data.  Don't do anything."),iT(e,i,"ok",void 0);return}e.server_.onDisconnectMerge(t.toString(),n,(r,s)=>{"ok"===r&&Q(n,(n,i)=>{let r=tn(i);tE(e.onDisconnect_,eR(t,n),r)}),iT(e,i,r,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iW{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return eD(this._path)?null:eN(this._path)}get ref(){return new iK(this._repo,this._path)}get _queryIdentifier(){let e=Y(ty(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return ty(this._queryParams)}isEqual(e){if(!((e=(0,m.m9)(e))instanceof iW))return!1;let t=this._repo===e._repo,n=eM(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function ij(e,t){if(!0===e._orderByCalled)throw Error(t+": You can't combine multiple orderBy calls.")}function iV(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===eK){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==W)throw Error(i);if("string"!=typeof t)throw Error(r)}if(e.hasEnd()){if(e.getIndexEndName()!==j)throw Error(i);if("string"!=typeof n)throw Error(r)}}else if(e.getIndex()===e3){if(null!=t&&!n4(t)||null!=n&&!n4(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,m.hu)(e.getIndex() instanceof ti||e.getIndex()===ts,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function iz(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class iK extends iW{constructor(e,t){super(e,t,new tp,!1)}get parent(){let e=eO(this._path);return null===e?null:new iK(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class iY{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new eS(e),n=iG(this.ref,e);return new iY(this._node.getChild(t),n,e3)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new iY(n,iG(this.ref,t),e3)))}hasChild(e){let t=new eS(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function i$(e,t){return(e=(0,m.m9)(e))._checkNotDeleted("ref"),void 0!==t?iG(e._root,t):e._root}function iQ(e,t){(e=(0,m.m9)(e))._checkNotDeleted("refFromURL");let n=iA(t,e._repo.repoInfo_.nodeAdmin);is("refFromURL",n);let i=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||i.host===e._repo.repoInfo_.host||F("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+e._repo.repoInfo_.host+")"),i$(e,n.path.toString())}function iG(e,t){return null===eI((e=(0,m.m9)(e))._path)?ii("child","path",t,!1):it("child","path",t,!1),new iK(e._repo,eR(e._path,t))}function iZ(e,t){ir("set",(e=(0,m.m9)(e))._path),n5("set",t,e._path,!1);let n=new m.BH;return ib(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}class iJ{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new iq("value",this,new iY(e.snapshotNode,new iK(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new iB(this,e,t):null}matches(e){return e instanceof iJ&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class iX{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new iB(this,e,t):null}createEvent(e,t){(0,m.hu)(null!=e.childName,"Child events should have a childName.");let n=iG(new iK(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new iq(e.type,this,new iY(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof iX&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function i0(e,t,n,i,r){var s;let o,a;if("object"==typeof i&&(o=void 0,r=i),"function"==typeof i&&(o=i),r&&r.onlyOnce){let t=n,i=(n,i)=>{iE(e._repo,e,l),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}let h=new iU(n,o||void 0),l="value"===t?new iJ(h):new iX(t,h);return s=e._repo,a=".info"===eI(e._path)?nN(s.infoSyncTree_,e,l):nN(s.serverSyncTree_,e,l),ih(s.eventQueue_,e._path,a),()=>iE(e._repo,e,l)}function i1(e,t,n,i){return i0(e,"value",t,n,i)}function i2(e,t,n,i){return i0(e,"child_added",t,n,i)}function i3(e,t,n,i){return i0(e,"child_changed",t,n,i)}function i4(e,t,n,i){return i0(e,"child_moved",t,n,i)}function i5(e,t,n,i){return i0(e,"child_removed",t,n,i)}function i9(e,t,n){let i=null,r=n?new iU(n):null;"value"===t?i=new iJ(r):t&&(i=new iX(t,r)),iE(e._repo,e,i)}class i8{}class i6 extends i8{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){n5("endAt",this._value,e._path,!0);let t=tf(e._queryParams,this._value,this._key);if(iz(t),iV(t),e._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new iW(e._repo,e._path,t,e._orderByCalled)}}class i7 extends i8{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){var t,n,i;let r;n5("endBefore",this._value,e._path,!1);let s=(t=e._queryParams,n=this._value,i=this._key,(r=t.index_===eK||i?tf(t,n,i):tf(t,n,W)).endBeforeSet_=!0,r);if(iz(s),iV(s),e._queryParams.hasEnd())throw Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new iW(e._repo,e._path,s,e._orderByCalled)}}class re extends i8{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){n5("startAt",this._value,e._path,!0);let t=t_(e._queryParams,this._value,this._key);if(iz(t),iV(t),e._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new iW(e._repo,e._path,t,e._orderByCalled)}}class rt extends i8{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){var t,n,i;let r;n5("startAfter",this._value,e._path,!1);let s=(t=e._queryParams,n=this._value,i=this._key,(r=t.index_===eK||i?t_(t,n,i):t_(t,n,j)).startAfterSet_=!0,r);if(iz(s),iV(s),e._queryParams.hasStart())throw Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new iW(e._repo,e._path,s,e._orderByCalled)}}class rn extends i8{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new iW(e._repo,e._path,function(e,t){let n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class ri extends i8{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new iW(e._repo,e._path,function(e,t){let n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class rr extends i8{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ij(e,"orderByChild");let t=new eS(this._path);if(eD(t))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let n=new ti(t),i=tg(e._queryParams,n);return iV(i),new iW(e._repo,e._path,i,!0)}}class rs extends i8{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ij(e,"orderByKey");let t=tg(e._queryParams,eK);return iV(t),new iW(e._repo,e._path,t,!0)}}class ro extends i8{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ij(e,"orderByPriority");let t=tg(e._queryParams,e3);return iV(t),new iW(e._repo,e._path,t,!0)}}class ra extends i8{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ij(e,"orderByValue");let t=tg(e._queryParams,ts);return iV(t),new iW(e._repo,e._path,t,!0)}}class rh extends i8{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(n5("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new i6(this._value,this._key)._apply(new re(this._value,this._key)._apply(e))}}function rl(e,...t){let n=(0,m.m9)(e);for(let e of t)n=e._apply(n);return n}(0,m.hu)(!c,"__referenceConstructor has already been defined"),c=iK,(0,m.hu)(!d,"__referenceConstructor has already been defined"),d=iK;let ru={};function rc(e,t,n,i,r){var s,o;let a,h,l,u,c=i||e.options.databaseURL;void 0===c&&(e.options.projectId||F("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),A("Using default host for project ",e.options.projectId),c=`${e.options.projectId}-default-rtdb.firebaseio.com`);let d=iA(c,r),p=d.repoInfo;"undefined"!=typeof process&&process.env&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?(u=!0,p=(d=iA(c=`http://${l}?ns=${p.namespace}`,r)).repoInfo):u=!d.repoInfo.secure;let _=r&&u?new e_(e_.OWNER):new ep(e.name,e.options,t);return is("Invalid Firebase Database URL",d),eD(d.path)||F("Database URL must point to the root of a Firebase Database (not including a child path)."),new rd((s=p,o=new ed(e.name,n),(a=ru[e.name])||(a={},ru[e.name]=a),(h=a[s.toURLString()])&&F("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),h=new id(s,!1,_,o),a[s.toURLString()]=h,h),e)}class rd{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=eo(e.repoInfo_),e.forceRestClient_||"".search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new tv(e.repoInfo_,(t,n,i,r)=>{ig(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>im(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,m.Wl)(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new eW(e.repoInfo_,t,(t,n,i,r)=>{ig(e,t,n,i,r)},t=>{im(e,t)},t=>{Q(t,(t,n)=>{iy(e,t,n)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let n=e.toString();return es[n]||(es[n]=t()),es[n]}(e.repoInfo_,()=>new tT(e.stats_,e.server_)),e.infoData_=new tb,e.infoSyncTree_=new nw({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=nI(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),iy(e,"connected",!1),e.serverSyncTree_=new nw({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);il(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new iK(this._repo,eT())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){let n=ru[t];n&&n[e.key]===e||F(`Database ${t}(${e.repoInfo_}) has already been deleted.`),iw(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&F("Cannot call "+e+" on a deleted database.")}}function rp(){ev.IS_TRANSPORT_INITIALIZED&&q("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function r_(){rp(),em.forceDisallow()}function rf(){rp(),el.forceDisallow(),em.forceAllow()}function rg(e,t){D(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}eW.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},eW.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},eh=g.Client,ea=v.SDK_VERSION,(0,v._registerComponent)(new f.wA("database",(e,{instanceIdentifier:t})=>rc(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,v.registerVersion)(eu,ec,"node"),(0,v.registerVersion)(eu,ec,"esm2017");/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ry=new y.Yd("@firebase/database-compat"),rv=function(e){ry.warn("FIREBASE WARNING: "+e)},rb=function(e,t,n,i){if((!i||void 0!==n)&&"boolean"!=typeof n)throw Error((0,m.gK)(e,t)+"must be a boolean.")},rC=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw Error((0,m.gK)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e){this._delegate=e}cancel(e){(0,m.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,m.Wj)("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),t=>e(t)),t}remove(e){(0,m.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,m.Wj)("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),t=>e(t)),t}set(e,t){(0,m.Dv)("OnDisconnect.set",1,2,arguments.length),(0,m.Wj)("OnDisconnect.set","onComplete",t,!0);let n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){(0,m.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,m.Wj)("OnDisconnect.setWithPriority","onComplete",n,!0);let i=this._delegate.setWithPriority(e,t);return n&&i.then(()=>n(null),e=>n(e)),i}update(e,t){if((0,m.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let t={};for(let n=0;n<e.length;++n)t[""+n]=e[n];e=t,rv("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,m.Wj)("OnDisconnect.update","onComplete",t,!0);let n=this._delegate.update(e);return t&&n.then(()=>t(null),e=>t(e)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,m.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,m.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,m.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,m.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,m.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,m.Dv)("DataSnapshot.child",0,1,arguments.length),it("DataSnapshot.child","path",e=String(e),!1),new rS(this._database,this._delegate.child(e))}hasChild(e){return(0,m.Dv)("DataSnapshot.hasChild",1,1,arguments.length),it("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,m.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,m.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,m.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new rS(this._database,t)))}hasChildren(){return(0,m.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,m.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,m.Dv)("DataSnapshot.ref",0,0,arguments.length),new rI(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class rT{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,i){var r;(0,m.Dv)("Query.on",2,4,arguments.length),(0,m.Wj)("Query.on","callback",t,!1);let s=rT.getCancelAndContextArgs_("Query.on",n,i),o=(e,n)=>{t.call(s.context,new rS(this.database,e),n)};o.userCallback=t,o.context=s.context;let a=null===(r=s.cancel)||void 0===r?void 0:r.bind(s.context);switch(e){case"value":return i1(this._delegate,o,a),t;case"child_added":return i2(this._delegate,o,a),t;case"child_removed":return i5(this._delegate,o,a),t;case"child_changed":return i3(this._delegate,o,a),t;case"child_moved":return i4(this._delegate,o,a),t;default:throw Error((0,m.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if((0,m.Dv)("Query.off",0,3,arguments.length),rC("Query.off",e,!0),(0,m.Wj)("Query.off","callback",t,!0),(0,m.lb)("Query.off","context",n,!0),t){let i=()=>{};i.userCallback=t,i.context=n,i9(this._delegate,e,i)}else i9(this._delegate,e)}get(){return(function(e){e=(0,m.m9)(e);let t=new iJ(new iU(()=>{}));return(function(e,t,n){let i=function(e,t){var n;let i=t._path,r=null;e.syncPointTree_.foreachOnPath(i,(e,t)=>{let n=eA(e,i);r=r||ny(t,n)});let s=e.syncPointTree_.get(i);s?r=r||ny(s,eT()):(s=new n_,e.syncPointTree_=e.syncPointTree_.set(i,s));let o=null!=r,a=o?new tD(r,!0,!1):null,h=(n=e.pendingWriteTree_,t6(t._path,n));return tB(ng(s,t,h,o?a.getNode():e7.EMPTY_NODE,o).viewCache_)}(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then(i=>{let r;let s=tn(i).withIndex(t._queryParams.getIndex());if(nN(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())r=nI(e.serverSyncTree_,t._path,s);else{let n=nD(e.serverSyncTree_,t);r=nx(e.serverSyncTree_,t._path,s,n)}return il(e.eventQueue_,t._path,r),nk(e.serverSyncTree_,t,n,null,!0),s},n=>(iS(e,"get for query "+(0,m.Wl)(t)+" failed: "+n),Promise.reject(Error(n))))})(e._repo,e,t).then(t=>new iY(t,new iK(e._repo,e._path),e._queryParams.getIndex()))})(this._delegate).then(e=>new rS(this.database,e))}once(e,t,n,i){(0,m.Dv)("Query.once",1,4,arguments.length),(0,m.Wj)("Query.once","callback",t,!0);let r=rT.getCancelAndContextArgs_("Query.once",n,i),s=new m.BH,o=(e,n)=>{let i=new rS(this.database,e);t&&t.call(r.context,i,n),s.resolve(i)};o.userCallback=t,o.context=r.context;let a=e=>{r.cancel&&r.cancel.call(r.context,e),s.reject(e)};switch(e){case"value":i1(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":i2(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":i5(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":i3(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":i4(this._delegate,o,a,{onlyOnce:!0});break;default:throw Error((0,m.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return(0,m.Dv)("Query.limitToFirst",1,1,arguments.length),new rT(this.database,rl(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToFirst: First argument must be a positive integer.");return new rn(e)}(e)))}limitToLast(e){return(0,m.Dv)("Query.limitToLast",1,1,arguments.length),new rT(this.database,rl(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToLast: First argument must be a positive integer.");return new ri(e)}(e)))}orderByChild(e){return(0,m.Dv)("Query.orderByChild",1,1,arguments.length),new rT(this.database,rl(this._delegate,function(e){if("$key"===e)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return it("orderByChild","path",e,!1),new rr(e)}(e)))}orderByKey(){return(0,m.Dv)("Query.orderByKey",0,0,arguments.length),new rT(this.database,rl(this._delegate,new rs))}orderByPriority(){return(0,m.Dv)("Query.orderByPriority",0,0,arguments.length),new rT(this.database,rl(this._delegate,new ro))}orderByValue(){return(0,m.Dv)("Query.orderByValue",0,0,arguments.length),new rT(this.database,rl(this._delegate,new ra))}startAt(e=null,t){return(0,m.Dv)("Query.startAt",0,2,arguments.length),new rT(this.database,rl(this._delegate,function(e=null,t){return ie("startAt","key",t,!0),new re(e,t)}(e,t)))}startAfter(e=null,t){return(0,m.Dv)("Query.startAfter",0,2,arguments.length),new rT(this.database,rl(this._delegate,(ie("startAfter","key",t,!0),new rt(e,t))))}endAt(e=null,t){return(0,m.Dv)("Query.endAt",0,2,arguments.length),new rT(this.database,rl(this._delegate,(ie("endAt","key",t,!0),new i6(e,t))))}endBefore(e=null,t){return(0,m.Dv)("Query.endBefore",0,2,arguments.length),new rT(this.database,rl(this._delegate,(ie("endBefore","key",t,!0),new i7(e,t))))}equalTo(e,t){return(0,m.Dv)("Query.equalTo",1,2,arguments.length),new rT(this.database,rl(this._delegate,(ie("equalTo","key",t,!0),new rh(e,t))))}toString(){return(0,m.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,m.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,m.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof rT))throw Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){let i={cancel:void 0,context:void 0};if(t&&n)i.cancel=t,(0,m.Wj)(e,"cancel",i.cancel,!0),i.context=n,(0,m.lb)(e,"context",i.context,!0);else if(t){if("object"==typeof t&&null!==t)i.context=t;else if("function"==typeof t)i.cancel=t;else throw Error((0,m.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.")}return i}get ref(){return new rI(this.database,new iK(this._delegate._repo,this._delegate._path))}}class rI extends rT{constructor(e,t){super(e,new iW(t._repo,t._path,new tp,!1)),this.database=e,this._delegate=t}getKey(){return(0,m.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,m.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new rI(this.database,iG(this._delegate,e))}getParent(){(0,m.Dv)("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new rI(this.database,e):null}getRoot(){return(0,m.Dv)("Reference.root",0,0,arguments.length),new rI(this.database,this._delegate.root)}set(e,t){(0,m.Dv)("Reference.set",1,2,arguments.length),(0,m.Wj)("Reference.set","onComplete",t,!0);let n=iZ(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(e,t){if((0,m.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){let t={};for(let n=0;n<e.length;++n)t[""+n]=e[n];e=t,rv("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ir("Reference.update",this._delegate._path),(0,m.Wj)("Reference.update","onComplete",t,!0);let n=function(e,t){n6("update",t,e._path,!1);let n=new m.BH;return function(e,t,n,i){iS(e,"update",{path:t.toString(),value:n});let r=!0,s=i_(e),o={};if(Q(n,(n,i)=>{r=!1,o[n]=nV(eR(t,n),tn(i),e.serverSyncTree_,s)}),r)A("update() called with empty data.  Don't do anything."),iT(e,i,"ok",void 0);else{let r=iv(e),s=function(e,t,n,i){var r;r=e.pendingWriteTree_,(0,m.hu)(i>r.lastWriteId,"Stacking an older merge on top of newer ones"),r.allWrites.push({path:t,children:n,writeId:i,visible:!0}),r.visibleWrites=tz(r.visibleWrites,t,n),r.lastWriteId=i;let s=tW.fromObject(n);return nO(e,new tR(tI(),t,s))}(e.serverSyncTree_,t,o,r);ia(e.eventQueue_,s),e.server_.merge(t.toString(),n,(n,s)=>{let o="ok"===n;o||q("update at "+t+" failed: "+n);let a=nT(e.serverSyncTree_,r,!o),h=a.length>0?ix(e,t):t;il(e.eventQueue_,h,a),iT(e,i,n,s)}),Q(n,n=>{let i=iR(e,eR(t,n));ix(e,i)}),il(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){(0,m.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,m.Wj)("Reference.setWithPriority","onComplete",n,!0);let i=function(e,t,n){if(ir("setWithPriority",e._path),n5("setWithPriority",t,e._path,!1),n7("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";let i=new m.BH;return ib(e._repo,e._path,t,n,i.wrapCallback(()=>{})),i.promise}(this._delegate,e,t);return n&&i.then(()=>n(null),e=>n(e)),i}remove(e){var t;(0,m.Dv)("Reference.remove",0,1,arguments.length),(0,m.Wj)("Reference.remove","onComplete",e,!0);let n=(ir("remove",(t=this._delegate)._path),iZ(t,null));return e&&n.then(()=>e(null),t=>e(t)),n}transaction(e,t,n){(0,m.Dv)("Reference.transaction",1,3,arguments.length),(0,m.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,m.Wj)("Reference.transaction","onComplete",t,!0),rb("Reference.transaction","applyLocally",n,!0);let i=(function(e,t,n){var i;if(ir("Reference.transaction",(e=(0,m.m9)(e))._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";let r=null===(i=null==n?void 0:n.applyLocally)||void 0===i||i,s=new m.BH,o=i1(e,()=>{});return function(e,t,n,i,r,s){iS(e,"transaction on "+t);let o={path:t,update:n,onComplete:i,status:null,order:x(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=iI(e,t,void 0);o.currentInputSnapshot=a;let h=o.update(a.val());if(void 0===h)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{let n;n9("transaction failed: Data returned ",h,o.path),o.status=0;let i=n$(e.transactionQueueTree_,t),r=nQ(i)||[];r.push(o),nG(i,r),"object"==typeof h&&null!==h&&(0,m.r3)(h,".priority")?(n=(0,m.DV)(h,".priority"),(0,m.hu)(n4(n),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):n=(nP(e.serverSyncTree_,t)||e7.EMPTY_NODE).getPriority().val();let s=i_(e),l=tn(h,n),u=nz(l,a,s);o.currentOutputSnapshotRaw=l,o.currentOutputSnapshotResolved=u,o.currentWriteId=iv(e);let c=nS(e.serverSyncTree_,t,u,o.currentWriteId,o.applyLocally);il(e.eventQueue_,t,c),ik(e,e.transactionQueueTree_)}}(e._repo,e._path,t,(t,n,i)=>{let r=null;t?s.reject(t):(r=new iY(i,new iK(e._repo,e._path),e3),s.resolve(new rm(n,r)))},o,r),s.promise})(this._delegate,e,{applyLocally:n}).then(e=>new rw(e.committed,new rS(this.database,e.snapshot)));return t&&i.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),i}setPriority(e,t){(0,m.Dv)("Reference.setPriority",1,2,arguments.length),(0,m.Wj)("Reference.setPriority","onComplete",t,!0);let n=function(e,t){ir("setPriority",(e=(0,m.m9)(e))._path),n7("setPriority",t,!1);let n=new m.BH;return ib(e._repo,eR(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){(0,m.Dv)("Reference.push",0,2,arguments.length),(0,m.Wj)("Reference.push","onComplete",t,!0);let n=function(e,t){let n;ir("push",(e=(0,m.m9)(e))._path),n5("push",t,e._path,!0);let i=iF(ip(e._repo)),r=iG(e,i),s=iG(e,i);return n=null!=t?iZ(s,t).then(()=>s):Promise.resolve(s),r.then=n.then.bind(n),r.catch=n.then.bind(n,void 0),r}(this._delegate,e),i=n.then(e=>new rI(this.database,e));t&&i.then(()=>t(null),e=>t(e));let r=new rI(this.database,n);return r.then=i.then.bind(i),r.catch=i.catch.bind(i,void 0),r}onDisconnect(){return ir("Reference.onDisconnect",this._delegate._path),new rE(new iH(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:r_,forceLongPolling:rf}}useEmulator(e,t,n={}){(function(e,t,n,i={}){var r;let s;(e=(0,m.m9)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&F("Cannot call useEmulator() after instance has already been initialized.");let o=e._repoInternal;o.repoInfo_.nodeAdmin?(i.mockUserToken&&F('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new e_(e_.OWNER)):i.mockUserToken&&(s=new e_("string"==typeof i.mockUserToken?i.mockUserToken:(0,m.Sg)(i.mockUserToken,e.app.options.projectId))),r=s,o.repoInfo_=new et(`${t}:${n}`,!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0),r&&(o.authTokenProvider_=r)})(this._delegate,e,t,n)}ref(e){return((0,m.Dv)("database.ref",0,1,arguments.length),e instanceof rI)?new rI(this,iQ(this._delegate,e.toString())):new rI(this,i$(this._delegate,e))}refFromURL(e){return(0,m.Dv)("database.refFromURL",1,1,arguments.length),new rI(this,iQ(this._delegate,e))}goOffline(){var e;return(0,m.Dv)("database.goOffline",0,0,arguments.length),e=this._delegate,void((e=(0,m.m9)(e))._checkNotDeleted("goOffline"),iw(e._repo))}goOnline(){var e,t;return(0,m.Dv)("database.goOnline",0,0,arguments.length),e=this._delegate,void((e=(0,m.m9)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(ic))}}rk.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:e=>({".sv":{increment:e}})};var rx=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){let a;ea=n;let h=new f.H0("database-standalone"),l=new f.zt("auth-internal",h);return l.setComponent(new f.wA("auth-internal",()=>i,"PRIVATE")),r&&(a=new f.zt("app-check-internal",h)).setComponent(new f.wA("app-check-internal",()=>r,"PRIVATE")),{instance:new rk(rc(e,l,a,t,o),e),namespace:s}}});/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rN=rk.ServerValue;!function(e){e.INTERNAL.registerComponent(new f.wA("database-compat",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app-compat").getImmediate();return new rk(e.getProvider("database").getImmediate({identifier:t}),n)},"PUBLIC").setServiceProps({Reference:rI,Query:rT,Database:rk,DataSnapshot:rS,enableLogging:rg,INTERNAL:rx,ServerValue:rN}).setMultipleInstances(!0)),e.registerVersion("@firebase/database-compat","1.0.3","node")}(_.Z)},73371:(e,t,n)=>{"use strict";n.d(t,{Y:()=>s});var i=n(14082),r=n(40815);function s(e,...t){let n=e.length;return(0,i.N)(t.filter(r.i),function(){let i="";for(let s=0;s<n;s++){i+=e[s];let n=t[s];n&&(i+=(0,r.i)(n)?n.get():n)}return i})}}};